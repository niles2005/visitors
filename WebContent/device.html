<!doctype html>
<html ng-app>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="css/bootstrap.css"/>
        <script src="scripts/angular.js"></script>
        <script>
            function BindState($scope, $http) {
                $scope.doAll = function() {
                    var url = "work?action=listdevices";
                    //console.dir(url);
                    $http.get(url).success(function(data) {
                        if(data && data.group) {
                            $scope.devices = data.group;
                        }
                    });
                }
                
                $scope.setDevice = function(device) {
                    $scope.selectDevice = device;
                }
                $scope.kk = "index";
                $scope.doAll();

                $scope.doUpdate = function() {
                    var url = "work?action=setdevice";
                    if($scope.selectDevice) {
                        $http.get(url, {params: {id: $scope.selectDevice.id, locate: $scope.selectDevice.locate, info: $scope.selectDevice.info}}).success(function(data) {
                            $scope.selectDevice = data;
                            $scope.doAll();
                        });
                        
                    }
                }


            }
        </script>
    </head>
    <body>
    <div style="margin-top: 80px"></div>
        <div class="container-fluid"  ng-controller="BindState">
            <div  class="row-fluid">
                <div class="span2">
                <form ng-submit="doUpdate()" >
                    Id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<input ng-model="selectDevice.id" /><br>
                    locate:<select ng-model="selectDevice.locate">
                                <option  value ='building1'> building1 </option>
                                <option  value ='building2'> building2 </option>
                                <option  value ='factory'> factory </option>
                                <option  value ='outside'> outside </option>
                    </select> <br>
                    info&nbsp;&nbsp;&nbsp;&nbsp;:<input ng-model="selectDevice.info"><br>
                    date&nbsp;&nbsp;:{{ selectDevice.createTime | date:'yyyy-MM-dd HH:mm:ss' }} <br>
                    <input type="submit" value="新增/更新"/>
                </form>
                <p><p>
                 </div>
                <div class="span10">
                <table class="table table-bordered">
                    <tr>
                        <th><a href="" ng-click="kk = 'index'; reverse=false">index</a></th>
                        <th><a href="" ng-click="kk = 'id'; reverse=!reverse">id</a></th>
                        <th><a href="" ng-click="kk = 'locate'; reverse=!reverse">locate</a></th>
                        <th><a href="" ng-click="kk = 'info'; reverse=!reverse">info</a></th>
                        <th><a href="" ng-click="kk = 'createTime'; reverse=!reverse">createTime</a></th>
                    </tr>
                    <tr ng-repeat="device in devices | orderBy:kk:reverse" ng-click="setDevice(device)">
                        <td>{{$index + 1}}</td>
                        <td>{{device.id}}</td>
                        <td>{{device.locate}}</td>
                        <td>{{device.info}}</td>
                        <td>{{device.createTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                    </tr>
                </table>
                </div>
            </div>
        </div>
    </body>
</html>