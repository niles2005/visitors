function printMap(e){return window.print(),!1}function setCookie(e,t,n){var r=new Date;n?r.setTime(r.getTime()+n*24*60*60*1e3):r.setTime(r.getTime()+2592e6),document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()}function getCookie(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return t!=null?unescape(t[2]):null}function delCookie(e){var t=new Date;t.setTime(t.getTime()-1);var n=getCookie(e);n!=null&&(document.cookie=e+"="+n+";expires="+t.toGMTString())}var mapwork=window.mapwork={};mapwork.ajaxtype=0,mapwork.actions={},mapwork.isIE=navigator.userAgent.indexOf("MSIE")>=0&&navigator.userAgent.indexOf("Opera")<0,mapwork.IEVersion=0,mapwork.isIE&&navigator.appName=="Microsoft Internet Explorer"&&(navigator.appVersion.match(/7./i)=="7."?mapwork.IEVersion=7:navigator.appVersion.match(/8./i)=="8."?mapwork.IEVersion=8:navigator.appVersion.match(/9./i)=="9."?mapwork.IEVersion=9:mapwork.IEVersion=6),mapwork.isIELess9=navigator.userAgent.indexOf("MSIE")>=0&&navigator.userAgent.indexOf("Opera")<0,mapwork.isFirefox=navigator.userAgent.indexOf("Firefox")>=0,mapwork.isOpera=navigator.userAgent.indexOf("Opera")>=0,mapwork.supportSVG=document.createElementNS!=null;if(!mapwork.supportSVG){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var style=document.createStyleSheet(),VMLel=["line","stroke","path","polyline","fill","oval","shape"];for(var i=0,l=VMLel.length;i<l;i++)style.addRule("v\\:"+VMLel[i],"behavior: url(#default#VML);"),style.addRule("v\\:"+VMLel[i],"antialias: true;")}String.prototype.endsWith=function(e){return e==null||e==""||this.length<e.length?!1:this.substring(this.length-e.length)==e},String.prototype.startsWith=function(e){return e==null||e==""||this.length<e.length?!1:this.substring(0,e.length)==e},Array.remove=function(e,t,n){var r=e.slice((n||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,r)},function(){mapwork.version=4,mapwork.LIMIT_MAX_ZOOM=17,mapwork.LIMIT_MIN_ZOOM=16,mapwork.mapStyle1="sd",mapwork.mapStyle2="sh2",mapwork.mapStyle3="sh3",mapwork.mapStyleT="shT",mapwork.trafficRefreshTime=12e4,mapwork.mapStyle=mapwork.mapStyle1,mapwork.serviceAddress0="http://127.0.0.1:8080/",mapwork.serviceAddress1="http://172.16.0.119:8080/",mapwork.serviceAddress2="http://localhost:8080/",mapwork.serviceAddress3="/",mapwork.serviceAddress4="http://172.16.0.119/",mapwork.serviceAddress=mapwork.serviceAddress3,mapwork.configs={defaultLat:31.270839,defaultLon:121.827126,defaultZoom:16,tileLayer_url:mapwork.serviceAddress+"tile?v="+mapwork.version,trafficTileLayer_url:mapwork.serviceAddress+"gisserver/mt?v="+mapwork.version,routeLayer_url:mapwork.serviceAddress+"gisserver/rr",searchLayer_url:mapwork.serviceAddress+"gisserver/ss",segmentQuery_url:mapwork.serviceAddress1+"gisserver/bb",setAddress:function(e){mapwork.serviceAddress=e,mapwork.configs.tileLayer_url=mapwork.serviceAddress+"gisserver/mt?v="+mapwork.version,mapwork.configs.trafficTileLayer_url=mapwork.serviceAddress+"gisserver/mt?v="+mapwork.version,mapwork.configs.routeLayer_url=mapwork.serviceAddress+"gisserver/rr",mapwork.configs.searchLayer_url=mapwork.serviceAddress+"gisserver/ss",mapwork.configs.segmentQuery_url=mapwork.serviceAddress+"gisserver/bb"}}}(),function(){function t(t,n,r,i){e&&e.apply(this,arguments),this.init(t,n,r,i)}mapwork.Bounds=t;var e=null;t.prototype={init:function(e,t,n,r){e===undefined?this.setToNull():(e<n?(this._minx=e,this._maxx=n):(this._minx=n,this._maxx=e),t<r?(this._miny=t,this._maxy=r):(this._miny=r,this._maxy=t))},setToNull:function(){this._minx=0,this._miny=0,this._maxx=-1,this._maxy=-1},isNull:function(){return this._maxx<this._minx},getWidth:function(){return this.isNull()?0:this._maxx-this._minx},getHeight:function(){return this.isNull()?0:this._maxy-this._miny},getMaxX:function(){return this._maxx},getMinX:function(){return this._minx},getMaxY:function(){return this._maxy},getMinY:function(){return this._miny},getCenterX:function(){return(this._minx+this._maxx)/2},getCenterY:function(){return(this._miny+this._maxy)/2},expandBy:function(e,t){if(this.isNull())return;this._minx-=e,this._miny-=t,this._maxx+=e,this._maxy+=t,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()},expandToIncludePoint:function(e,t){this.isNull()?(this._minx=e,this._miny=t,this._maxx=e,this._maxy=t):(e<this._minx&&(this._minx=e),t<this._miny&&(this._miny=t),e>this._maxx&&(this._maxx=e),t>this._maxy&&(this._maxy=t))},expandToIncludeBounds:function(e){this.isNull()?(this._minx=e._minx,this._miny=e._miny,this._maxx=e._maxx,this._maxy=e._maxy):(e._minx<this._minx&&(this._minx=e._minx),e._miny<this._miny&&(this._miny=e._miny),e._maxx>this._maxx&&(this._maxx=e._maxx),e._maxy>this._maxy&&(this._maxy=e._maxy))},translate:function(e,t){if(this.isNull())return;this.init(this._minx+e,this._miny+t,this._maxx+e,this._maxy+t)},intersectBounds:function(e){return this.isNull()||e.isNull()?!1:e._minx<=this._maxx&&e._maxx>=this._minx&&e._miny<=this._maxy&&e._maxy>=this._miny},intersectPoint:function(e,t){return e<=this._maxx&&e>=this._minx&&t<=this._maxy&&t>=this._miny},intersectRect:function(e,t,n,r){return this._minx<=n&&this._maxx>=e&&this._miny<=r&&this._maxy>=t},intersection:function(e){if(this.isNull()||e.isNull()||!this.intersectsBounds(e))return new mapwork.Bounds(0,0,-1,-1);var t=this._minx<=e._minx?e._minx:this._minx,n=this._miny<=e._miny?e._miny:this._miny,r=this._maxx>=e._maxx?e._maxx:this._maxx,i=this._maxy>=e._maxy?e._maxy:this._maxy;return new mapwork.Bounds(t,r,n,i)},overlapPoint:function(e,t){return this.intersectsPoint(e,t)},overlapBounds:function(e){return this.intersectsBounds(e)},containPoint:function(e,t){return e>=this._minx&&e<=this._maxx&&t>=this._miny&&t<=this._maxy},containBounds:function(e){return this.isNull()||e.isNull()?!1:e._minx>=this._minx&&e._maxx<=this._maxx&&e._miny>=this._miny&&e._maxy<=this._maxy},equals:function(e){return this.isNull()?e.isNull():this._maxx==e.getMaxX()&&this._maxy==e.getMaxY()&&this._minx==e.getMinX()&&this._miny==e.getMinY()},toString:function(){return"Bounds:("+this._minx+","+this._miny+" , "+this._maxx+","+this._maxy+")"}},e&&mapwork.utils.inherits(t,e)}(),function(){function e(){}function t(e){var t={x:0,y:0};while(e)t.x+=e.offsetLeft,t.y+=e.offsetTop,e=e.offsetParent;return t}mapwork.utils={inherits:function(t,n){var r=t.prototype;e.prototype=n.prototype;var i=new e;e.prototype=null;for(prop in r)i[prop]=r[prop];t.prototype=i,i.constructor=t},extend:function(e,t){for(var n in t)e[n]=t[n];return e},removeItem:function(e,t){var n=e.length;if(n<=0)return;while(n--)if(e[n]===t){e.splice(n,1);break}},loadJsonData:function(e,t,n){mapwork.ajaxtype==0?$.ajax({url:e,data:n,dataType:"json",cache:!1,success:t}):FlyJSONP.get({url:e,parameters:n,success:t,error:function(e){}})},loadXMLFile:function(e,t,n){$.ajax({url:e,dataType:"xml",cache:!1,success:function(){t.apply(n,arguments)}})},getStyleWidth:function(e){var t=e.style.width;return t.endsWith("px")&&(t=t.substring(0,t.length-2)),t=parseInt(t),t},getStyleHeight:function(e){var t=e.style.height;return t.endsWith("px")&&(t=t.substring(0,t.length-2)),t=parseInt(t),t},getStyleTop:function(e){var t=e.style.top;return t.endsWith("px")&&(t=t.substring(0,t.length-2)),t=parseInt(t),t},getStyleLeft:function(e){var t=e.style.left;return t.endsWith("px")&&(t=t.substring(0,t.length-2)),t=parseInt(t),t},bindEvent:function(e,t,n){window.addEventListener?e.addEventListener(t,n,!1):window.attachEvent&&e.attachEvent("on"+t,n)},unbindEvent:function(e,t,n){window.addEventListener?e.removeEventListener(t,n,!1):window.attachEvent&&e.detachEvent("on"+t,n)},getWindowWidth:function(){var e=0;return typeof window.innerWidth=="number"?e=window.innerWidth:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?e=document.documentElement.clientWidth:document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientWidth),e},getWindowHeight:function(){var e=0;return typeof window.innerHeight=="number"?e=window.innerHeight:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?e=document.documentElement.clientHeight:document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientHeight),e},getPageX:function(e){return e.pageX||e.pageY?e.pageX:e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft},getPageY:function(e){return e.pageX||e.pageY?e.pageY:e.clientY+document.body.scrollTop+document.documentElement.scrollTop},getMapLayerX:function(e,t){return mapwork.isIE?e.x:e.clientX-t._map._div.offsetLeft},getMapLayerY:function(e,t){return mapwork.isIE?e.y:e.clientY-t._map._div.offsetTop},getOffset:function(e){var n=e.target;n.offsetLeft==undefined&&(n=n.parentNode);var r=t(n),i={x:window.pageXOffset+e.clientX,y:window.pageYOffset+e.clientY},s={offsetX:i.x-r.x,offsetY:i.y-r.y};return s},getClientSize:function(){return window.innerHeight?{width:window.innerWidth,height:window.innerHeight}:document.documentElement&&document.documentElement.clientHeight?{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}:{width:document.body.clientWidth,height:document.body.clientHeight}},getFitZoom:function(e){var t=mapwork.MapLocation.LIMIT_MAX_ZOOM,n=mapwork.MapLocation.LIMIT_MIN_ZOOM;for(var r=t;r>=n;r--){var i=Math.pow(2,8+r);if(e>i)return r}return n},formatDate:function(e,t){var n=e.getYear()+1900,r=e.getMonth()+1;r<10&&(r="0"+r);var i=e.getDate();i<10&&(i="0"+i);var s=e.getHours();s<10&&(s="0"+s);var o=e.getMinutes();o<10&&(o="0"+o);var u=e.getSeconds();return u<10&&(u="0"+u),t==="day"?n+"-"+r+"-"+i:t==="time"?s+":"+o+":"+u:n+"-"+r+"-"+i+" "+s+":"+o+":"+u},date8ToDate10:function(e,t){return e.length===8?(t||(t="-"),e.substring(0,4)+t+e.substring(4,6)+t+e.substring(6)):e.length===10?e:null},date10ToDate8:function(e){return e.length===10?e.substring(0,4)+e.substring(5,7)+e.substring(8):e.length===8?e:null}}}(),function(){var e=Math.PI/180;mapwork.gisUtils={getMeterLength:function(t,n){var r=t.getDLat()*e,i=t.getDLon()*e,s=n.getDLat()*e,o=n.getDLon()*e,u=r-s,a=i-o,f=2*Math.asin(Math.sqrt(Math.pow(Math.sin(u/2),2)+Math.cos(r)*Math.cos(s)*Math.pow(Math.sin(a/2),2)));return f*6378137},getDisplayLength:function(e){return e>=1e3?(e/1e3).toFixed(2)+" 公里":e.toFixed(2)+" 米"}}}(),function(){function e(t,n,r){r?(this._latitude=t,this._longitude=n):(this._latitude=Math.round(t*e.SCALE_FACTOR),this._longitude=Math.round(n*e.SCALE_FACTOR))}mapwork.EarthPos=e,e.MAX_LAT=850511287,e.MIN_LAT=-850511287,e.SCALE_FACTOR=1e7,e.prototype={getILat:function(){return this._latitude},getILon:function(){return this._longitude},getDLat:function(){return 1*this._latitude/e.SCALE_FACTOR},getDLon:function(){return 1*this._longitude/e.SCALE_FACTOR},convert2GlobalPos:function(){var t,n;return t=(1*this._longitude/e.SCALE_FACTOR+180)/360,n=Math.log(Math.tan((1*this._latitude/e.SCALE_FACTOR+90)*Math.PI/360)),n=.5-n/2/Math.PI,new mapwork.GlobalPos(t,n)},getLatLonString:function(){return this.getDLat()+","+this.getDLon()},equals:function(e){return this._latitide==e._latitide&&this._longitude===e._longitude},toString:function(){return"EarthPos:["+this._latitude+","+this._longitude+"]"}}}(),function(){function e(e,t){this.posX=e,this.posY=t}mapwork.GlobalPos=e,e.prototype={getPosX:function(){return this.posX},getPosY:function(){return this.posY},convert2EarthPos:function(){var e,t;return this._posY<0||this._posY>1?null:(t=this.posX*360-Math.floor(this.posX)*360-180,this.posX==1&&(t=180),e=(.5-this.posY)*2*Math.PI,e=Math.atan(Math.exp(e))/Math.PI*360-90,new mapwork.EarthPos(e,t,!1))},toString:function(){return"GlobalPos:["+this.posX+","+this.posY+"]"}}}(),function(){function t(t,n,r,i,s){e&&e.apply(this,arguments),this._imageUrl=t,this._width=n,this._height=r,this._offsetX=i,this._offsetY=s}mapwork.SpriteImage=t;var e=null;t.prototype={wrapImage:function(e){e.src="images/transparent.png",e.style.width=this._width+"px",e.style.height=this._height+"px",e.style.background="url("+this._imageUrl+") no-repeat "+this._offsetX+"px "+this._offsetY+"px"},setOffset:function(e,t){this._offsetX=e,this._offsetY=t}},e&&mapwork.utils.inherits(t,e)}(),function(){function s(e){var t=e,n=0;if(t>1){while(t>=10)t/=10,n+=1;t>=5?t=5:t>=2?t=2:t=1;while(n>0)t*=10,n-=1}return t}function o(e,t){var n=e.getDLat()*i,r=e.getDLon()*i,s=t.getDLat()*i,o=t.getDLon()*i,u=n-s,a=r-o,f=2*Math.asin(Math.sqrt(Math.pow(Math.sin(u/2),2)+Math.cos(n)*Math.cos(s)*Math.pow(Math.sin(a/2),2)));return 6378137*f}var e="公里",t="英里",n="米",r="英尺",i=Math.PI/180;mapwork.MapRulerBuilder={getOffsetLon4RangeLength:function(e,t){if(!e||t<=0)return null;var n=Math.sin(1*t/6378137/2),r=n*n,s=Math.cos(e.getDLat()*i),o=s*s,u=Math.asin(Math.sqrt(r/o))*2,a=parseInt(1e7*u/i+.5);return a},createMapRuler:function(e,t,n,r){if(!e)return null;if(!n){if(!t&&t!=0)return null;n=1<<8+t}var i=new mapwork.GlobalPos(e.posX-r/2/n,e.posY),s=new mapwork.GlobalPos(e.posX+r/2/n,e.posY),o=i.convert2EarthPos(),u=s.convert2EarthPos();return this.decideScale(o,u,r)},decideScale:function(i,u,a){if(i==null||u==null)return null;var f=o(i,u),l=s(f);if(l<1)return null;var c,h,p,d=0;l>=1e3?(p=s(f/1e3),h=Math.round(a*p/(f/1e3)),c=parseInt(p)+" "+e,d=p*1e3):(h=Math.round(a*l/f),c=parseInt(l)+" "+n,d=l);var v=f/1609.344,m=f*3.28084,g,y,b,w;return v>=1?(b=s(v),g=Math.round(a*b/v),y=parseInt(b)+" "+t):(w=s(m),g=Math.round(a*w/m),y=parseInt(w)+" "+r),{fpsLength:g,metricLength:h,fpsText:y,metricText:c,meters:d}}}}(),function(){var e=new mapwork.EarthPos(312354340,1214671520,!0),t=e.convert2GlobalPos();mapwork.SHPosMapping={convertShPosToGlobalPos:function(e,n){e-=660606.640282;var r=e/3428e4+t.posX;n=477300.294757-n;var i=-n/3419e4+t.posY;return new mapwork.GlobalPos(r,i)},convertShPosToEarthPos:function(e,n){e-=660606.640282;var r=e/3428e4+t.posX;n=477300.294757-n;var i=-n/3419e4+t.posY,s=new mapwork.GlobalPos(r,i);return s.convert2EarthPos()}}}(),function(){function t(t,n,r,i,s,o){e&&e.apply(this,arguments),this._lat1=t,this._lon1=n,this._lat2=r,this._lon2=i,this._lonNum=o,this._latNum=s,this._lonOffset=(this._lon2-this._lon1)/(this._lonNum+1),this._latOffset=(this._lat1-this._lat2)/(this._latNum+1),this.moduleItemArray=[]}mapwork.MapRect=t;var e=null;t.prototype={addMoudleItem:function(e){var t=this.moduleItemArray.length%this._lonNum+1,n=parseInt(this.moduleItemArray.length/this._lonNum)+1,r=this._lon1+this._lonOffset*t,i=this._lat1-this._latOffset*n,s=new mapwork.EarthPos(i,r,!0);e.setEarthPos(s),this.moduleItemArray.push(e)}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this.rects={},this.rects.building1=new mapwork.MapRect(312739670,1218214740,312696020,1218272250,4,5),this.rects.building2=new mapwork.MapRect(312739670,1218272250,312696020,1218332760,4,5),this.rects.factory=new mapwork.MapRect(312690150,1218189200,312674190,1218358070,2,20)}mapwork.MapRectManager=t;var e=null;t.prototype={addModuleItem:function(e){var t=e._json.locate;if(t){var n=this.rects[t];n&&n.addMoudleItem(e)}}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(t){e&&e.apply(this,arguments),this._layerId=t,this._div=document.createElement("div"),typeof t=="string"&&(this._div.className=t),this._div.style.position="absolute"}mapwork.Layer=t;var e=null;t.prototype={getLayerId:function(){return this._layerId},setMap:function(e){this._map=e},getMap:function(){return this._map},getDiv:function(){return this._div},getClassName:function(){return this._div.className},setClassName:function(e){this._div.className=e},destroy:function(){},setLayerContainer:function(e){this._layerContainer=e},initLayer:function(){},draggedLayer:function(){},resizeLayer:function(){},changedLayerZoom:function(){}},e&&mapwork.utils.inherits(t,e)}(),function(){mapwork.eventBase={addListener:function(e,t){this.getListeners(e).push(t)},removeListener:function(e,t){var n=getListeners(e);mapwork.utils.removeItem(n,t)},fireEvent:function(e){var t=this.getListeners(e);for(var n in t)t[n].apply(this,arguments)},getListeners:function(e){return e=e.toLowerCase(),this._listeners||(this._listeners={}),this._listeners[e]||(this._listeners[e]=[]),this._listeners[e]}}}(),function(){function t(){e&&e.apply(this,arguments)}function n(e){function o(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1);var t=e.clientX-i;t>s&&(t=s),n.style.left=t+"px"}function u(e){var s;e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1),r.id=="w_hsp"?(s=e.clientX-i-2,t.enableW(s)):r.id=="e_hsp"&&(s=e.clientX-i+2+r.offsetWidth,s=window.innerWidth-s,t.enableE(s)),document.body.style.cursor="default",mapwork.utils.unbindEvent(document,"mousemove",o),mapwork.utils.unbindEvent(document,"mouseup",u),n.style.display="none"}e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1);var t=this,n=t._dd,r=e.target;r||(r=e.srcElement);var i=e.clientX-r.offsetLeft;n.style.left=r.offsetLeft+"px",n.style.top=r.offsetTop+"px",n.style.width=r.offsetWidth+"px",n.style.height=r.offsetHeight+"px",n.style.display="block",document.body.style.cursor="ew-resize";var s=document.width;mapwork.utils.bindEvent(document,"mousemove",o),mapwork.utils.bindEvent(document,"mouseup",u)}mapwork.WebFrame=t;var e=null;t.prototype={initFrame:function(){this._c=document.getElementById("c"),this._n=document.getElementById("n"),this._w=document.getElementById("w"),this._e=document.getElementById("e"),this._s=document.getElementById("s"),this._w_hsp=document.getElementById("w_hsp"),this._e_hsp=document.getElementById("e_hsp"),this._dd=document.getElementById("dd"),this._w_hsp.style.display=this._w.style.display,this._e_hsp.style.display=this._e.style.display,this._w_hsp.style.left=this._w.offsetWidth+2+"px",this._e_hsp.style.right=this._e.offsetWidth+"px";var e=this,t=function(){e.resetSize()};window.onload=t,window.onresize=t;var r=function(t){n.apply(e,arguments)};mapwork.utils.bindEvent(this._w_hsp,"mousedown",r),mapwork.utils.bindEvent(this._e_hsp,"mousedown",r)},isEnableW:function(){return this._w.style.display!="none"},disableW:function(){this._w.style.display="none",this._w_hsp.style.display="none",this.resetSize()},enableW:function(e){e&&(this._w.style.width=e+"px"),this._w.style.display="block",this._w_hsp.style.left=this._w.offsetWidth+2+"px",this._w_hsp.style.display="block",this.resetSize()},isEnableE:function(){return this._e.style.display!="none"},disableE:function(){this._e.style.display="none",this._e_hsp.style.display="none",this.resetSize()},enableE:function(e){e&&(this._e.style.width=e+"px"),this._e.style.display="block",this._e_hsp.style.right=this._e.offsetWidth+"px",this._e_hsp.style.display="block",this.resetSize()},resetSize:function(){var e=this._c.offsetTop,t=0;this._w.style.display!="none"&&(t=this._w.offsetWidth,this._w_hsp.offsetWidth>0&&(t=this._w.offsetWidth+this._w_hsp.offsetWidth+2)),this._c.style.marginLeft=t+"px";var n=0;this._e.style.display!="none"&&(n=this._e.offsetWidth+this._e_hsp.offsetWidth+2),this._c.style.marginRight=n+"px";var r=mapwork.utils.getWindowHeight()-e-this._s.offsetHeight;this._w.style.height=r+"px",this._e.style.height=r+"px",this._c.style.height=r+"px",this._w_hsp.style.height=r+"px",this._e_hsp.style.height=r+"px",this.onWindowResize()},onWindowResize:function(){}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments)}mapwork.WebPanel=t;var e=null;t.prototype={initFrame:function(){var e=this,t=function(){e.resetSize()};window.onload=t,window.onresize=t},resetSize:function(){this.onWindowResize()},onWindowResize:function(){}},e&&mapwork.utils.inherits(t,e)}(),function(){var e=64,t=0,n=0,r={},i=[e];mapwork.TileImageCache={getImage:function(e){return r[e]},cacheImage:function(s,o){if(n<e)r[s]=o,i[t]=s,n++;else{var u=i[t];delete r[u],i[t]=s,r[s]=o}t++,t>=e&&(t=0)}}}(),function(){var e=[],t=[];mapwork.TileStore={getImageTile:function(){var t=e.pop();if(t)return t;var n=new mapwork.ImageTile;return n},returnImageTile:function(t){t&&e.push(t)},getImageTileCount:function(){return e.length},getMapTile:function(){var e=t.pop();if(e)return e;var n=new mapwork.MapTile;return n},returnMapTile:function(e){e&&t.push(e)},getMapTileCount:function(){return t.length}}}(),function(){function t(){e&&e.apply(this,arguments),this._layer=null,this._tileX=0,this._tileY=0,this._zoom=0,this._queued=!1,this._loading=!1,this._drawn=!1,this._loadImage=!0,this._loadImage?(this._image=document.createElement("img"),this._image.style.position="absolute",this._image.style.width="256px",this._image.style.height="256px",this._image.style["-moz-user-select"]="none",this._image.style["-webkit-user-select"]="none"):(this._canvas=document.createElement("canvas"),this._canvas&&this._canvas.getContext&&(this._context=this._canvas.getContext("2d")),this._canvas.style.position="absolute",this._canvas.style.width="256px",this._canvas.style.height="256px",this._canvas.width="256",this._canvas.height="256")}mapwork.ImageTile=t;var e=null;t.prototype={addToLayer:function(e,t,n,r,i,s){this._layer=e,this._tileX=t,this._tileY=n,this._zoom=r,this._loadImage?e.getDiv().appendChild(this._image):e.getDiv().appendChild(this._canvas),this.moveTo(i,s)},offsetPos:function(e,t){this.moveTo(this._left+e,this._top+t)},moveTo:function(e,t){this._left=e,this._top=t,this._loadImage?(this._image.style.left=e+"px",this._image.style.top=t+"px"):(this._canvas.style.left=e+"px",this._canvas.style.top=t+"px")},destroy:function(){this.clear(),this._layer&&(this._layer=null),mapwork.TileStore.returnImageTile(this)},draw:function(){if(this._loadImage){var e=this._layer.makeTileUrl(this._tileX,this._tileY,this._zoom);e||(e="mapwork/images/empty.png");var t=this._tileX,n=this._tileY,r=this;this._image.onload=function(e){r._tileX==t&&r._tileY==n&&(r._image.style.display="block")},this._image.onerror=function(e){r._tileX==t&&r._tileY==n};try{this._image.src=e}catch(i){}}else this._context.fillStyle="#000",this._context.clearRect(0,0,256,256),this._context.fillText(this._tileX+" "+this._tileY,30,30),this._context.strokeRect(2,2,252,252),this._canvas.style.display="block"},clear:function(){this._loadImage?(this._image.style.display="none",this._layer.getDiv().removeChild(this._image)):(this._canvas.style.display="none",this._layer.getDiv().removeChild(this._canvas))}},e&&mapwork.utils.inherits(t,e)}(),function(){function e(){}mapwork.MapEvent=e,e.RESIZE="mapwork.mapresize",e.DRAGSTATUS_CHANGE="mapwork.dragstatuschange",e.LUKUANGSTATUS_CHANGE="mapwork.lukuangstatuschange",e.MOVING="mapwork.mapmoving",e.MOVE_END="mapwork.mapmoveend",e.ZOOM_END="mapwork.mapzoomend",e.TRACKLOAD_END="mapwork.trackloadend",e.FOCUSTRACKPOINT_CHANGED="mapwork.focustrackpointchanged",e.FOCUSTRACKUSER_CHANGED="mapwork.focustrackuserchanged"}(),function(){function t(t,n,r,i){e&&e.apply(this,arguments),this._centerTileEdgeX=0,this._centerTileEdgeY=0,n=n||mapwork.configs.defaultLat,r=r||mapwork.configs.defaultLon,i=i||mapwork.configs.defaultZoom,this._maxZoom=mapwork.LIMIT_MAX_ZOOM,this._minZoom=mapwork.LIMIT_MIN_ZOOM,this._map=t,this._mapCenterEPos=new mapwork.EarthPos(n,r),this._mapCenterGPos=this._mapCenterEPos.convert2GlobalPos(),this._zoom=i,i>mapwork.LIMIT_MAX_ZOOM?this._zoom=mapwork.LIMIT_MAX_ZOOM:i<mapwork.LIMIT_MIN_ZOOM&&(this._zoom=mapwork.LIMIT_MIN_ZOOM),this._edgeNum=Math.pow(2,this._zoom),this._edgeLen=this._edgeNum*256,this._centerTileEdgeX=this._edgeNum*this._mapCenterGPos.posX,this._centerTileEdgeY=this._edgeNum*this._mapCenterGPos.posY}mapwork.MapLocation=t;var e=null;t.prototype={getCenterTileX:function(){return parseInt(this._centerTileEdgeX)},getCenterTileY:function(){return parseInt(this._centerTileEdgeY)},getLatitude:function(){return this._mapCenterEPos.getDLat()},getLongitude:function(){return this._mapCenterEPos.getDLon()},_movingMapCenterGlobalPos:function(e){this._mapCenterGPos=e,this._mapCenterEPos=this._mapCenterGPos.convert2EarthPos(),this._centerTileEdgeX=this._edgeNum*this._mapCenterGPos.posX,this._centerTileEdgeY=this._edgeNum*this._mapCenterGPos.posY,this._map.fireEvent(mapwork.MapEvent.MOVING,this._map)},_movedToMapCenterGlobalPos:function(e){this._mapCenterGPos=e,this._mapCenterEPos=this._mapCenterGPos.convert2EarthPos(),this._centerTileEdgeX=this._edgeNum*this._mapCenterGPos.posX,this._centerTileEdgeY=this._edgeNum*this._mapCenterGPos.posY,this._map.fireEvent(mapwork.MapEvent.MOVE_END,this._map)},_zoomToMapCenter:function(e,t){if(!this.isValidZoom(t))return;var n,r;if(e instanceof mapwork.GlobalPos)n=e,r=n.convert2EarthPos();else{if(!(e instanceof mapwork.EarthPos))return;r=e,n=r.convert2GlobalPos()}this._zoom=t,this._edgeNum=Math.pow(2,this._zoom),this._edgeLen=this._edgeNum*256,this._mapCenterGPos=n,this._mapCenterEPos=r,this._centerTileEdgeX=this._edgeNum*this._mapCenterGPos.posX,this._centerTileEdgeY=this._edgeNum*this._mapCenterGPos.posY,this._map.fireEvent(mapwork.MapEvent.ZOOM_END,this._map)},setZoom:function(e){if(!this.isValidZoom(e))return;if(this._zoom===e)return;this._zoom=e,this._edgeNum=Math.pow(2,this._zoom),this._edgeLen=this._edgeNum*256,this._centerTileEdgeX=this._edgeNum*this._mapCenterGPos.posX,this._centerTileEdgeY=this._edgeNum*this._mapCenterGPos.posY,this._map.fireEvent(mapwork.MapEvent.ZOOM_END,this._map)},offsetZoom:function(e){this.setZoom(this._zoom+e)},getWindowLeftTopGlobalPos:function(){var e=this._mapCenterGPos.posX-this._map._size.width/2/this._edgeLen,t=this._mapCenterGPos.posY-this._map._size.height/2/this._edgeLen;return new mapwork.GlobalPos(e,t)},getWindowRightBottomGlobalPos:function(){var e=this._mapCenterGPos.posX+this._map._size.width/2/this._edgeLen,t=this._mapCenterGPos.posY+this._map._size.height/2/this._edgeLen;return new mapwork.GlobalPos(e,t)},isValidZoom:function(e){return e<this._minZoom?!1:e>this._maxZoom?!1:!0},getCenterTileEdgeX:function(){return this._centerTileEdgeX},getCenterTileEdgeY:function(){return this._centerTileEdgeY},getMapCenterGlobalPos:function(){return this._mapCenterGPos},getMapCenterEarthPos:function(){return this._mapCenterEPos},getGlobalPosFromMapPos:function(e,t){var n=(e-this._map._size.width/2)/this._edgeLen+this._mapCenterGPos.posX,r=(t-this._map._size.height/2)/this._edgeLen+this._mapCenterGPos.posY;return new mapwork.GlobalPos(n,r)},getMapPosFromGlobalPos:function(e){var t=(e.posX-this._mapCenterGPos.posX)*this._edgeLen+this._map._size.width/2,n=(e.posY-this._mapCenterGPos.posY)*this._edgeLen+this._map._size.height/2;return[t,n]},getEarthPosFromMapPos:function(e,t){var n=this.getGlobalPosFromMapPos(e,t),r=n.convert2EarthPos();return r},getZoom:function(){return this._zoom},getEdgeNum:function(){return this._edgeNum},getEdgeLen:function(){return this._edgeLen},getMap:function(){return this._map},getCenterTileId:function(){return this.getCenterTileX()+","+this.getCenterTileY()+","+this.getZoom()},getWindowBounds:function(){var e=this.getWindowLeftTopGlobalPos(),t=this.getWindowRightBottomGlobalPos(),n=e.convert2EarthPos(),r=t.convert2EarthPos(),i=n.getILon(),s=r.getILon();s<i&&s<0&&(s=18e7);var o=[n.getILat(),i,r.getILat(),s];return o},getWindowGlobalPosBounds:function(){var e=this._map._size.width/2/this._edgeLen,t=this._map._size.height/2/this._edgeLen,n=this._mapCenterGPos.posX-e,r=this._mapCenterGPos.posY-t,i=this._mapCenterGPos.posX+e,s=this._mapCenterGPos.posY+t;return new mapwork.Bounds(n,r,i,s)},getWindowPixelBounds:function(){var e=this._edgeLen*this._mapCenterGPos.posX,t=this._edgeLen*this._mapCenterGPos.posY,n=e-this._map._size.width/2,r=e+this._map._size.width/2,i=t-this._map._size.height/2,s=t+this._map._size.height/2;return new mapwork.Bounds(n,i,r,s)},getPageX:function(e){return mapwork.isIE&&mapwork.IEVersion<9?e.x:e.clientX-this._map._div.offsetLeft},getPageY:function(e){return mapwork.isIE&&mapwork.IEVersion<9?e.y:e.clientY-this._map._div.offsetTop}},e&&mapwork.utils.inherits(t,e)}(),function(){function n(t){e&&e.apply(this,arguments),this._layerId="LayerContainer",this._basePos=null,this._initMapY=0,this._layers={},this._map=t,this._mapLocation=t.getMapLocation(),this._div.style.position="absolute",this._div.id="layerContainer",this._layerOffsetPos=[0,0],this._div.style.left=this._layerOffsetPos[0]+"px",this._div.style.top=this._layerOffsetPos[1]+"px",this.initMapSize=!1,this.initMapEvent(),this.addLayer(new mapwork.TileLayer),this.addLayer(new mapwork.MapVectorLayer),this.addLayer(new mapwork.MapShadowLayer),this.addLayer(new mapwork.MapIconLayer),this.addLayer(new mapwork.MapLabelLayer),this.addLayer(new mapwork.MapPopLayer)}mapwork.LayerContainer=n;var e=mapwork.Layer,t=mapwork.utils;n.prototype={getLayerOffsetPos:function(){return this._layerOffsetPos},initMapEvent:function(){this._map.addEventListener(mapwork.MapEvent.RESIZE,this.onMapResize,this),this._map.addEventListener(mapwork.MapEvent.MOVING,this.onMapMoving,this),this._map.addEventListener(mapwork.MapEvent.MOVE_END,this.onMapMoved,this),this._map.addEventListener(mapwork.MapEvent.ZOOM_END,this.onMapZoom,this)},onMapResize:function(){var e;this.initMapSize=!0;var t=this._map.getSize(),n=this._mapLocation.getEdgeLen();if(this._basePos==null){for(e in this._layers)this._layers[e].initLayer();var r=this._mapLocation.getMapCenterGlobalPos();this._basePos=[r.posX-1*t.width/2/n,r.posY-1*t.height/2/n]}else{var i=this._basePos[0]+(-this._layerOffsetPos[0]+t.width/2)/n,s=this._basePos[1]+(-this._layerOffsetPos[1]+t.height/2)/n;this._mapLocation._movedToMapCenterGlobalPos(new mapwork.GlobalPos(i,s));for(e in this._layers)this._layers[e].resizeLayer()}},onMapMoved:function(){if(!this.initMapSize)return;for(var e in this._layers)this._layers[e].draggedLayer()},onMapZoom:function(){if(!this.initMapSize)return;this._layerOffsetPos=[0,0],this._div.style.left=this._layerOffsetPos[0]+"px",this._div.style.top=this._layerOffsetPos[1]+"px";for(var e in this._layers)this._layers[e].changedLayerZoom();var t=this._mapLocation.getMapCenterGlobalPos(),n=this._map.getSize(),r=this._mapLocation.getEdgeLen();this._basePos=[t.posX-1*n.width/2/r,t.posY-1*n.height/2/r]},addLayer:function(e){if(e&&e instanceof mapwork.Layer){var t=e.getLayerId();t&&(this._layers[t]=e,e.setMap(this._map),e.setLayerContainer(this),this._div.appendChild(e.getDiv()))}},removeLayer:function(e){e&&(delete this._layers[e.getLayerId()],this._div.removeChild(e.getDiv()))},getLayer:function(e){return this._layers[e]},getLayers:function(){return this._layers},onMapMoving:function(){for(var e in this._layers)this._layers[e].draggedLayer()},movingToMapCenter:function(e){var t;if(e instanceof mapwork.GlobalPos)t=e;else{if(!(e instanceof mapwork.EarthPos))return;t=e.convert2GlobalPos()}var n=this._map.getMapLocation(),r=n.getEdgeLen(),i=this._map.getSize();this._layerOffsetPos[0]=(this._basePos[0]-t.posX)*r+i.width/2,this._layerOffsetPos[1]=(this._basePos[1]-t.posY)*r+i.height/2,this._div.style.left=this._layerOffsetPos[0]+"px",this._div.style.top=this._layerOffsetPos[1]+"px",n._movingMapCenterGlobalPos(t)},movedToMapCenter:function(e){var t;if(e instanceof mapwork.GlobalPos)t=e;else{if(!(e instanceof mapwork.EarthPos))return;t=e.convert2GlobalPos()}var n=this._map.getMapLocation(),r=n.getEdgeLen(),i=this._map.getSize();this._layerOffsetPos[0]=(this._basePos[0]-t.posX)*r+i.width/2,this._layerOffsetPos[1]=(this._basePos[1]-t.posY)*r+i.height/2,this._div.style.left=this._layerOffsetPos[0]+"px",this._div.style.top=this._layerOffsetPos[1]+"px",n._movedToMapCenterGlobalPos(t)},movedMap:function(e,t){var n=this._map.getMapLocation(),r=n.getEdgeLen(),i=this._map.getSize();this._layerOffsetPos[0]+=e,this._layerOffsetPos[1]+=t,this._div.style.left=this._layerOffsetPos[0]+"px",this._div.style.top=this._layerOffsetPos[1]+"px";var s=this._basePos[0]+(-this._layerOffsetPos[0]+i.width/2)/r,o=this._basePos[1]+(-this._layerOffsetPos[1]+i.height/2)/r;n._movedToMapCenterGlobalPos(new mapwork.GlobalPos(s,o))},movingMap:function(e,t){var n=this._map.getMapLocation(),r=n.getEdgeLen(),i=this._map.getSize();this._layerOffsetPos[0]+=e,this._layerOffsetPos[1]+=t,this._div.style.left=this._layerOffsetPos[0]+"px",this._div.style.top=this._layerOffsetPos[1]+"px";var s=this._basePos[0]+(-this._layerOffsetPos[0]+i.width/2)/r,o=this._basePos[1]+(-this._layerOffsetPos[1]+i.height/2)/r;n._movingMapCenterGlobalPos(new mapwork.GlobalPos(s,o))},dragMap:function(e,t){this._div.style.left=e+"px",this._div.style.top=t+"px";for(var n in this._layers)this._layers[n].draggedLayer()},onMouseDown:function(e,n){if(this._map.getMode()!=0)return;if(!this.initMapSize)return;if(e.stopPropagation){e.stopPropagation(),e.preventDefault();if(e.button!=0)return}else{e.cancelBubble=!0,e.returnValue=!1;if(e.button!=1)return}if(mapwork.DragRectControl.doDragRect){var r=this._map.getControl(mapwork.DragRectControl
.ID);r&&r.startDrag(e,this._mapLocation,n);return}var i=this._layerOffsetPos[0],s=this._layerOffsetPos[1],o=0,u=0,a=0,f=0,l=0,c=0,h=0,p=this,d=t.getPageX(e),v=t.getPageY(e),m,g,y=function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1),n;var r=t.getPageX(e),y=t.getPageY(e);u=(new Date).getTime(),a=u-o,o=u,f=c,l=h,c=r,h=y;if(m!=r||g!=y){m=r,g=y;var b=r-d+i-p._layerOffsetPos[0],w=y-v+s-p._layerOffsetPos[1];p.movingMap(b,w)}},b=function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1),n,t.unbindEvent(document,"mousemove",y),t.unbindEvent(document,"mouseup",b);var r=t.getPageX(e),m=t.getPageY(e);u=(new Date).getTime(),a+=u-o,c=r,h=m;if(a>0&&a<20)p.doAfterDragMove(c-f,h-l);else{var g=r-d+i-p._layerOffsetPos[0],w=m-v+s-p._layerOffsetPos[1];p.movedMap(g,w)}};t.bindEvent(document,"mousemove",y),t.bindEvent(document,"mouseup",b)},doAfterDragMove:function(e,t){function u(){o.movingMap(r,i),s++,s>=n&&a&&(clearInterval(a),a=null,o.movedMap(0,0))}var n=50,r=e*5/n,i=t*5/n,s=0,o=this,a=setInterval(u,1)}},e&&mapwork.utils.inherits(n,e)}(),function(){function t(){e&&e.apply(this,arguments),this._handlerId=null}mapwork.Handler=t;var e=null;t.prototype={getHandlerId:function(){return this._handlerId},setMap:function(e){this._map=e}},e&&mapwork.utils.inherits(t,e)}(),function(){function n(){t&&t.apply(this,arguments),this._handlerId=n.ID}mapwork.MeasureHandler=n;var e=mapwork.utils;n.ID="MeasureHandler";var t=mapwork.Handler;n.prototype={beginMeasure:function(){this._map._div.style.cursor="crosshair",this._map.setMode(1)},stopMeasure:function(){this._map.setMode(0),this._map._div.style.cursor="default",this._measureLine&&(this._measureLine.doStop(),this._measureLine=null,this._currMeasureLine&&(this._currMeasureLine.doRemove(),this._currMeasureLine=null),e.unbindEvent(document,"mousemove",this._onMouseMove))},addMeasurePoint:function(t){if(!t)return;var n=this._map.getMapLocation(),r=n.getPageX(t),i=n.getPageY(t),s=n.getEarthPosFromMapPos(r,i);this._measureLine||(this._measureLine=new mapwork.MeasureLine(this._map),this._currMeasureLine=new mapwork.MeasureLine(this._map),this._currMeasureLine.setDash("5"),e.bindEvent(document,"mousemove",this._onMouseMove)),this._measureLine.addMeasurePos(s),this._currMeasureLine.clearPosList(),this._currMeasureLine.addPos(s)},setMap:function(e){function n(e){if(t._map.getMode()!=1)return;e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1);var n=t._map.getMapLocation(),r=n.getPageX(e),i=n.getPageY(e),s=t._map.getSize(),o=0,u=0;r<0?o=-1:r>=s.width-10&&(o=1),i<0?u=-1:i>=s.height-10&&(u=1),o!=0||u!=0?t.startMoving(o,u):t.stopMoving();var a=n.getEarthPosFromMapPos(r,i),f=t._currMeasureLine;f&&(f.getPosCount()==1?f.addPos(a):f.changeLastPos(a))}this._map=e,e.addEventListener("mouseup",this.onMouseUp,this),e.addEventListener("dblclick",this.onDblClick,this);var t=this;this._onMouseMove=n},onMouseUp:function(e){if(this._map.getMode()!=1)return;if(e.stopPropagation){e.stopPropagation(),e.preventDefault();if(e.button!=0){e.button==2&&this.stopMeasure();return}}else{e.cancelBubble=!0,e.returnValue=!1;if(e.button!=1)return e.button==2&&this.stopMeasure(),!1}this.addMeasurePoint(e)},onDblClick:function(e){if(this._map.getMode()!=1)return;if(e.stopPropagation){e.stopPropagation(),e.preventDefault();if(e.button!=0)return}else e.cancelBubble=!0,e.returnValue=!1;return this._measureLine.removeLastPos(),this.stopMeasure(),!1},startMoving:function(e,t){function r(){n.movingMap(-e*2,-t*2)}var n=this._map.getLayerContainer();this._movingInterval||(this._movingInterval=setInterval(r,1))},stopMoving:function(){this._movingInterval&&(clearInterval(this._movingInterval),this._movingInterval=null)}},t&&mapwork.utils.inherits(n,t)}(),function(){function t(){e&&e.apply(this,arguments),this._handlerId=t.ID,this._offsetStep=5,this._isOverMap=!1}mapwork.KeyHandler=t,t.ID="KeyHandler";var e=mapwork.Handler;t.prototype={setMap:function(e){this._map=e;var t=this;mapwork.utils.bindEvent(this._map._div,"mouseover",function(e){t._isOverMap=!0}),mapwork.utils.bindEvent(this._map._div,"mouseout",function(e){t._isOverMap=!1}),mapwork.utils.bindEvent(document,"keydown",function(e){t.onKeyDown(e)}),mapwork.utils.bindEvent(document,"keyup",function(e){t.onKeyUp(e)})},onKeyDown:function(e){if(!this._isOverMap)return;this._offsetStep+=2;var t=this._map.getMapLocation(),n=this._map.getLayerContainer();e.keyCode==38?n.movedMap(0,this._offsetStep):e.keyCode==40?n.movedMap(0,-this._offsetStep):e.keyCode==37?n.movedMap(this._offsetStep,0):e.keyCode==39?n.movedMap(-this._offsetStep,0):e.keyCode==33?t.offsetZoom(1):e.keyCode==34?t.offsetZoom(-1):e.keyCode==187?t.offsetZoom(1):e.keyCode==189&&t.offsetZoom(-1)},onKeyUp:function(e){if(!this._isOverMap)return;this._offsetStep=5}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._handlerId=t.ID}mapwork.DragHandler=t,t.ID="DragHandler";var e=mapwork.Handler;t.prototype={setMap:function(e){this._map=e;var t=e.getLayerContainer();e.addEventListener("mousedown",t.onMouseDown,t)}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this.interval=0,this._handlerId=t.ID,mapwork.isIE&&(this.interval=200),this._lastWheelTime=0}mapwork.WheelHandler=t,t.ID="WheelHandler";var e=mapwork.Handler;t.prototype={setMap:function(e){this._map=e;var t="mousewheel";mapwork.isFirefox&&(t="DOMMouseScroll"),e.addEventListener(t,this.onMouseWheel,this)},onMouseWheel:function(e){var t=(new Date).getTime();if(!(Math.abs(t-this._lastWheelTime)>200))return;this._lastWheelTime=t,e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1);var n=this._map.getMapLocation(),r=0;e||(e=window.event),e.wheelDelta==-120||e.wheelDelta==120?(r=e.wheelDelta/40,window.opera&&(r=-r)):e.detail&&(r=-e.detail);var i=n.getZoom();r==-3?(i--,this._isZoomUp=!0):r==3&&(i++,this._isZoomUp=!1);if(!n.isValidZoom(i))return;var s,o;mapwork.isIE?(s=e.x,o=e.y):(s=e.clientX-n._map._div.offsetLeft,o=e.clientY-n._map._div.offsetTop);if(this.interval){var u=this;this._timeoutId||(this._timeoutId=window.setTimeout(function(){u.doWheel(s,o,n,i)},this.interval))}else this.doWheel(s,o,n,i)},doWheel:function(e,t,n,r){window.clearTimeout(this._timeoutId),this._timeoutId=null,this._wheelRectControl=this._map.getControl(mapwork.WheelRectControl.ID),this._wheelRectControl&&this._wheelRectControl.doWheelFocus(this._isZoomUp,e,t);var i=n.getGlobalPosFromMapPos(e,t),s=Math.pow(2,8+r),o=i.posX+(this._map._size.width/2-e)/s,u=i.posY+(this._map._size.height/2-t)/s;this._map.zoomToMapCenter(new mapwork.GlobalPos(o,u),r)}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._handlerId=t.ID}mapwork.ClickLocationHandler=t,t.ID="ClickLocationHandler";var e=mapwork.Handler;t.prototype={setMap:function(e){this._map=e,e.addEventListener("mousedown",this.onMouseDown,this),e.addEventListener("dblclick",this.onClick,this),e.getPanelDivPos()},onMouseDown:function(e){if(this._map.getMode()!=0)return;this._mouseDownPos=[e.offsetX,e.offsetY]},onClick:function(e){if(this._map.getMode()!=0)return;if(this._mouseDownPos){var t=this._map.getMapLocation(),n=mapwork.utils.getMapLayerX(e,t),r=mapwork.utils.getMapLayerY(e,t),i=[e.offsetX,e.offsetY];if(i[0]==this._mouseDownPos[0]&&i[1]==this._mouseDownPos[1]){var s=this._map._size.width/2-n,o=this._map._size.height/2-r,u=this._map.getLayerContainer();u.movedMap(s,o),this._mouseDownPos=null}}}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._handlerId=t.ID}mapwork.RangeSearchHandler=t,t.ID="RangeSearchHandler";var e=mapwork.Handler;t.prototype={setMap:function(e){this._map=e,this._vectorlayer=this._map.getLayer(mapwork.MapVectorLayer.ID),this._mapPopLayer=this._map.getLayer(mapwork.MapPopLayer.ID),this._mapLabelLayer=this._map.getLayer(mapwork.MapLabelLayer.ID),this._rangeSearchDiv=document.createElement("div"),$(this._rangeSearchDiv).addClass("rangeSearch"),$(this._rangeSearchDiv).append("<div class = 'toolsContainer'><div class = 'title'><form name='rangeSearchForm'><input type='text' id='rangeSearchName'/><input type='image' id='rangeSearchButton' src='images/btn_tips_search.gif'></form></div><div class = 'content'><div class = 'aroundRule'><div class = 'ruleBg'></div><div class = 'ruleBar'></div><div class = 'ruleCursor'></div></div><div class = 'scale'><span style='left: 0%' class='tall'><ins style='margin-left: -4px; '>0</ins></span><span style='left: 10%'></span><span style='left: 20%' class='tall'><ins style='margin-left: -10.5px; '>1km</ins></span><span style='left: 30%'></span><span style='left: 40%' class='tall'><ins style='margin-left: -10.5px; '>2km</ins></span><span style='left: 50%'></span><span style='left: 60%' class='tall'><ins style='margin-left: -10.5px; '>3km</ins></span><span style='left: 70%'></span><span style='left: 80%' class='tall'><ins style='margin-left: -10.5px; '>4km</ins></span><span style='left: 90%'></span><span style='left: 100%' class='tall'><ins style='margin-left: -10.5px; '>5km</ins></span></div></div></div>"),this._$RuleCursor=$(this._rangeSearchDiv).find(".ruleCursor"),this._ruleCursor=this._$RuleCursor.get(0),this._ruleBar=$(this._rangeSearchDiv).find(".ruleBar").get(0);var t=this;mapwork.utils.bindEvent(this._ruleCursor,"click",function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1)}),mapwork.utils.bindEvent(this._ruleCursor,"mousedown",function(e){t.dragRuleCursor(e)}),this._aroundRule=$(this._rangeSearchDiv).find(".aroundRule").get(0),mapwork.utils.bindEvent(this._aroundRule,"click",function(e){t._ruleCursorOffsetX=e.offsetX,t._currentRadius=e.offsetX*20,t.doAnimate(e.offsetX),t.doSearch()});var n=$(this._rangeSearchDiv).find("form[name='rangeSearchForm']").get(0);n.onsubmit=function(){return t.doSearch(),!1},$(this._rangeSearchDiv).find(".searchType > a").each(function(){this.onclick=function(){var e=$(this).html();$(t._rangeSearchDiv).find("#rangeSearchName").val(e),t.doSearch()}}),this._pinOffsetY=34,this._defaultRadius=500;var r=this._map.getMenu(),i=new mapwork.MenuGroup("search",2);i.addMenuItem("周边搜索",function(){t.doMenu(r.getMousePos())}),r.addMenuGroup(i)},doMenu:function(e){var t=this._map.getMapLocation(),n=t.getEarthPosFromMapPos(e.posX,e.posY);this.openRangeSearchControl(n)},openRangeSearchControl:function(e){var t=this,n=function(){t.doClose()};this._map.openTip(e,"周边搜索",this._rangeSearchDiv,"",this._pinOffsetY,n);var r=this._currentRadius?this._currentRadius:this._defaultRadius;this.createControl(e,r),this._ruleCursorOffsetX=r/20,this._ruleCursor.style.left=r/20+"px",this._ruleBar.style.width=r/20+"px"},createControl:function(e,t){this._searchCircle||(this._searchCircle=new mapwork.MapCircle("rangeSearchCircle"),this._searchCircle.setColor("#1791fc"),this._searchCircle.setFillColor("#1791fc"),this._searchCircle.setFillOpacity("0.2"),this._searchCircle.setStrokeOpacity("0.8"),this._searchCircle.setWidth("1")),this._searchCircle.setCenterPos(e),this._searchCircle.setRadius(t),this._vectorlayer.addElement(this._searchCircle),this._vectorlayer.resetElement(this._searchCircle);var n=this._searchCircle.getEEdgePos();this._radiusLine||(this._radiusLine=new mapwork.MapPath("radiusLine"),this._radiusLine.setDash("5,5"),this._radiusLine.setColor("#1791fc"),this._radiusLine.setWidth("1")),this._radiusLine.clearPosList(),this._radiusLine.addPos(e),this._radiusLine.addPos(n),this._vectorlayer.addElement(this._radiusLine),this._vectorlayer.resetElement(this._radiusLine),n&&(this._circleLabel||(this._circleLabel=new mapwork.MapLabel("circleLabel")),this._circleLabel.setPos(n),this._circleLabel.setName(parseInt(t)+"米"),this._circleLabel._offsetPos=[6,-13],this._mapLabelLayer.addElement(this._circleLabel),this._mapLabelLayer.resetElement(this._circleLabel));if(n){if(!this._ball){this._ball=new mapwork.MapIcon("boll","images/ball.png","images/ball.png",[5,5],100);var r=this}this._ball.setPos(n),this._mapPopLayer.addElement(this._ball),this._mapPopLayer.resetElement(this._ball)}if(!this._pin){this._pin=new mapwork.MapDraggableIcon("pin","images/arrow.png","images/arrow.png",[11,this._pinOffsetY],100);var r=this;this._pin.setDraggedFunc(function(){var t=r._pin.getEarthPos();t&&(e=t),r.openRangeSearchControl(e),r.doSearch()}),this._pinShadow=new mapwork.MapIcon("pinShadow","images/arrowshadow.png","images/arrowshadow.png",[0,22],90),this._pin.setShadowIcon(this._pinShadow)}var r=this;this._pin.getHtmlObj().onclick=function(){r.openRangeSearchControl(e)},this._pin.setPos(e),this._pinShadow.setPos(e),this._mapPopLayer.addElement(this._pin),this._mapPopLayer.addElement(this._pinShadow),this._mapPopLayer.resetElement(this._pin),this._mapPopLayer.resetElement(this._pinShadow)},doClose:function(){this._searchCircle&&(this._searchCircle.doRemove(),this._searchCircle=null),this._radiusLine&&(this._radiusLine.doRemove(),this._radiusLine=null),this._circleLabel&&(this._circleLabel.doRemove(),this._circleLabel=null),this._ball&&(this._ball.doRemove(),this._ball=null),this._searched||this.closePin()},closePin:function(){this._pin.doRemove(),this._pinShadow.doRemove(),this._pin=null,this._pinShadow=null},dragRuleCursor:function(e){this._pressX=mapwork.utils.getPageX(e);if(e.stopPropagation){e.stopPropagation(),e.preventDefault();if(e.button!=0)return}this._$RuleCursor.addClass("ruleCursorHover");var t=this,n=function(e){e.stopPropagation&&(e.stopPropagation(),e.preventDefault());var n=t._ruleCursorOffsetX+mapwork.utils.getPageX(e)-t._pressX;n>=0&&n<=250&&t.doAnimate(n)},r=function(e){e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),$(document).unbind("mousemove",n),$(document).unbind("mouseup",r),t._$RuleCursor.removeClass("ruleCursorHover"),t._ruleCursorOffsetX=t._$RuleCursor.position().left,t._currentRadius=t._$RuleCursor.position().left*20,t.doSearch()};$(document).bind("mousemove",n),$(document).bind("mouseup",r)},doAnimate:function(e){this._ruleCursor.style.left=e+"px",this._ruleBar.style.width=e+"px",this.setCircleRadius(e),this.setCircleLabel(e),this.setRadiusLine(),this.setBall()},setCircleRadius:function(e){this._searchCircle.setRadius(e*20),this._vectorlayer.resetElement(this._searchCircle)},setCircleLabel:function(e){var t=parseInt(e*20);this._circleLabel.setName(t+"米");var n=this._searchCircle.getEEdgePos();this._circleLabel.setPos(n),this._mapLabelLayer.resetElement(this._circleLabel)},setRadiusLine:function(){this._radiusLine.clearPosList();var e=this._searchCircle.getECenterPos(),t=this._searchCircle.getEEdgePos();this._radiusLine.addPos(e),this._radiusLine.addPos(t),this._vectorlayer.resetElement(this._radiusLine)},setBall:function(){var e=this._searchCircle.getEEdgePos();this._ball.setPos(e),this._mapPopLayer.resetElement(this._ball)},doSearch:function(e){var t=e?e:$(this._rangeSearchDiv).find("#rangeSearchName").val();if($.trim(t)=="")return;$(this._rangeSearchDiv).find("#rangeSearchName").val(t),this._searched=!0;var n=this._map._currentModule;n&&n.doRemoveIconList();var r=this._map.getLayer("moduleListLayer");r&&r.empty();var i=this._map.getModule(mapwork.Search.ID);i.init(),i.setSearchHandler(this),this._map._currentModule=i,i.setSearchType("range");var s=this._searchCircle._eCenterPos,o=this._searchCircle._radius;i.setSearchCenterEPos(s),i.setSearchRadius(o),i.doPageQuery(null,null,t)}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){return!1}function n(){e&&e.apply(this,arguments),this._div=document.createElement("div"),this._div.style.position="absolute",this._controlId=null}mapwork.Control=n;var e=null;n.prototype={getControlId:function(){return this._controlId},setMap:function(e){this._map=e},getMap:function(){return this._map},appendToDiv:function(e){e.appendChild(this._div)},getDiv:function(){return this._div},createImage:function(e,n,r,i,s,o){var u=document.createElement("img");n&&(u.name=n),u.src=r,u.style.position="absolute",u.style.left=i+"px",u.style.top=s+"px",u.ondragstart=t,e&&e.appendChild(u);if(o){var a=this;mapwork.utils.bindEvent(u,"mousedown",function(){o.apply(a,arguments)})}return u},createAbsoluteSpan:function(e,t,n,r,i){var s=document.createElement("span");return t&&(s.name=t),n&&(s.innerText=n,s.style.position="absolute",s.style.left=r+"px",s.style.top=i+"px"),e&&e.appendChild(s),s},createRelativeSpan:function(e,t,n,r,i){var s=document.createElement("span");return t&&(s.name=t),n&&(s.innerText=n,s.style.position="relative",s.style.left=r+"px",s.style.top=i+"px"),e&&e.appendChild(s),s},createDiv:function(e,t){var n=document.createElement("div");return t&&(n.name=t),e&&e.appendChild(n),n}},e&&mapwork.utils.inherits(n,e)}(),function(){function t(){e&&e.apply(this,arguments),this._controlId=t.ID,this._div.className="menuControl",this._div.style.zIndex=9999,this._div.style.position="absolute",this._div.style.display="none"}mapwork.MenuControl=t,t.ID="MenuControl";var e=mapwork.Control;t.prototype={buildMenuDiv:function(){this._isBuildMenu||(this._menu.buildMenuDiv(this._div),this._isBuildMenu=!0)},setMap:function(e){function n(e){return t.showMenu(e),!1}this._map=e,this._menu=e.getMenu();var t=this;mapwork.isIE?this._map._div.oncontextmenu=function(){event.returnValue=!1,event.cancelBubble=!0,n(event)}:this._map._div.oncontextmenu=n,this._map._div.onclick=function(){t.hideMenu()}},showMenu:function(e){if(this._map.getMode()!=0)return;var t,n;if(mapwork.isIE)t=e.x,n=e.y;else{var r=this._map.getMapLocation();t=e.clientX-r._map._div.offsetLeft,n=e.clientY-r._map._div.offsetTop}this._menu.getMenuGroupCount()>0&&(this.buildMenuDiv(),this._menu.setMousePos(t,n),this._div.style.top=n+"px",this._div.style.left=t+"px",this._div.style.display="block")},hideMenu:function(){this._div.style.display="none"}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._div.style.zIndex=1001,this._div.style.position="absolute",this._div.style.top="0px",this._div.style.left="0px",this._controlId=t.ID}mapwork.SimpleZoomControl=t,t.ID="SimpleZoomControl";var e=mapwork.Control;t.prototype={setMap:function(e){this._map=e;var t=this.createImage(this._div,"zoomdown","images/zoomrulerup.png",20,20,this.onClick);t.title="放大";var n=this.createImage(this._div,"zoomup","images/zoomrulerdown.png",50,20,this.onClick);n.title="缩小"},onClick:function(e){var t=e.target;t.name=="zoomdown"?this._map.getMapLocation().offsetZoom(1):t.name=="zoomup"&&this._map.getMapLocation().offsetZoom(-1)}},e&&mapwork.utils.inherits(t,e)}(),function(){function c(t){e&&e.apply(this,arguments),this._controlId=c.ID,this._div.style.zIndex=1002,this._div.style.position="absolute",this._div.style.top="10px",this._div.style.left="10px",this._div.style.width="50px",this._div.style.height="300px",this._div.style["-moz-user-select"]="none",this._div.style["-webkit-user-select"]="none",t==undefined&&(t=!0),this._displayZoomText=t===!0}mapwork.DetailZoomControl=c,c.ID="DetailZoomControl";var e=mapwork.Control,t="images/zoomrectenable.png",n="images/zoomrectdisable.png",r={up:[[27,8,43,22],[25,10,45,20],[23,12,47,18],[22,14,22,14],[22,14,49,16],[29,6,41,24],[31,4,39,25],[32,3,38,27],[33,2,37,28]],left:[[9,26,23,42],[7,28,26,39],[5,30,28,37],[3,32,29,36],[11,24,21,44],[13,23,19,45],[14,21,18,47]],right:[[46,27,62,40],[44,30,65,38],[42,31,67,36],[48,25,60,43],[50,23,59,45],[52,21,56,47]],down:[[27,46,43,60],[24,48,46,58],[22,51,48,55],[29,44,42,62],[31,42,39,64],[33,40,37,66]]},i=32,s=23,o=12,u=146,a=7,f=18,l=f-a+2;c.prototype={setMap:function(e){this._map=e,this._orientImage=this.createImage(this._div,"zoomorient","images/zoomorient.png",5,5,this.onClick),this._rulerButton=this.createImage(this._div,"zoomruler","images/zoomruler.png",35,77+s-2,this.onClick),this._rulerUpButton=this.createImage(this._div,"zoomrulerup","images/zoomrulerup.png",25,77,this.onClick),this._rulerDownButton=this.createImage(this._div,"zoomrulerdown","images/zoomrulerdown.png",25,77+s+u-4,this.onClick),this._sliderButton=this.createImage(this._div,"zoomslider","images/zoomslider.png",25,75,this.onClick),this._displayZoomText&&(this._zoomLabel=this.createAbsoluteSpan(this._div,"zoomLabel","10",55,105),this._zoomLabel.style.font="normal 12px Verdana",this._zoomLabel.style.color="#646464"),this._map.addEventListener(mapwork.MapEvent.ZOOM_END,this.onMapZoom,this),this._map.addEventListener(mapwork.MapEvent.DRAGSTATUS_CHANGE,this.changeDragStatus,this),this.resetSlider()},onClick:function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1);var t=e.target;t||(t=e.srcElement);var n=e.offsetX,i=e.offsetY;if(n==undefined||i==undefined){var s=mapwork.utils.getOffset(e);n=s.offsetX,i=s.offsetY}var o=this._map.getMapLocation();if(t.name=="zoomorient"){e.stopImmediatePropagation?e.stopImmediatePropagation():e.cancelBubble=!0;var a=this._map.getLayerContainer();for(var f in r){var l=r[f];if(l.length>0){var c=!1;for(var h=0;h<l.length;h++){var p=l[h];if(n>=p[0]&&n<=p[2]&&i>=p[1]&&i<=p[3]){c=!0;break}}if(c){if(f==="up"){a.movedMap(0,200);return}if(f==="left"){a.movedMap(200,0);return}if(f==="right"){a.movedMap(-200,0);return}if(f==="down"){a.movedMap(0,-200);return}}}}}else t.name=="zoomruler"?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.cancelBubble=!0,i>=0&&i<=u&&this.setSliderPos(i)):t.name=="zoomrulerup"?o.offsetZoom(1):t.name=="zoomrulerdown"?o.offsetZoom(-1):t.name!="zoomslider"&&(t.name=="zoomrect"?(mapwork.DragRectControl.doDragRect=!mapwork.DragRectControl.doDragRect,this.changeDragStatus()):t.name=="center")},onMapZoom:function(e){this.resetSlider()},setSliderPos:function(e){var t=(e-5)*l;t/=u;var n=f-parseInt(t),r=this._map.getMapLocation().getZoom();n!=r&&this._map.getMapLocation().setZoom(n)},resetSlider:function(){var e=this._map.getMapLocation().getZoom();if(!e&&e!==0)return;var t=mapwork.utils.getStyleTop(this._rulerButton),n=u*(f-e)/l+t+5;this._displayZoomText&&(this._zoomLabel.innerText=""+e,this._zoomLabel.style.top=n-2+"px"),this._sliderButton.style.top=n+"px"},changeDragStatus:function(){mapwork.DragRectControl.doDragRect?this._zoomRectImg.src=n:this._zoomRectImg.src=t}},e&&mapwork.utils.inherits(c,e)}(),function(){function t(){e&&e.apply(this,arguments),this._controlId=t.ID,this._div.style.zIndex=9700,this._div.style.position="absolute",this._div.style.top="0px",this._div.style.left="0px",this._imageWidth=19,this._imageHeight=19}mapwork.CenterCrossControl=t,t.ID="CenterCrossControl";var e=mapwork.Control;t.prototype={setMap:function(e){this._map=e,this._crossImage=this.createImage(this._div,"center","images/center.gif",0,0),this._crossWidth=mapwork.utils.getStyleWidth(this._crossImage),this._crossHeight=mapwork.utils.getStyleHeight(this._crossImage),this._map.addEventListener(mapwork.MapEvent.RESIZE,this.onMapResize,this)},onMapResize:function(){var e=this._map.getSize(),t=e.width/2-this._imageWidth/2,n=e.height/2-this._imageHeight/2;this._crossImage.style.left=t+"px",this._crossImage.style.top=n+"px"}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){return!1}function n(){var e=new Date,t=e.getHours();t<10&&(t="0"+t);var n=e.getMinutes();return n<10&&(n="0"+n),t+":"+n}function r(){e&&e.apply(this,arguments),this._controlId=r.ID,this._div.style.zIndex=1001,this._div.style.position="absolute",this._div.style.right="0px",this._div.style.left="0px",this._trafficButtonOpen=!1}mapwork.TrafficControl=r,r.ID="TrafficControl";var e=mapwork.Control;r.prototype={setMap:function(e){this._map=e,this._trafficButtonOpen=!1,this._wrapDiv=document.createElement("div"),this._wrapDiv.style.position="absolute",this._wrapDiv.style.right="146px",this._wrapDiv.style.top="20px",this._wrapDiv.style.width="280px",this._wrapDiv.style.height="30px",this._wrapDiv.style.background="url(images/trafficOpen.png) no-repeat 0 0",this._image=document.createElement("img"),this._image.src="images/refresh0.gif",this._image.style.position="absolute",this._image.style.left="10px",this._image.style.top="6px",this._image.title="刷新",this._image.style.cursor="pointer",this._image.ondragstart=t,this._wrapDiv.appendChild(this._image);var r=this;mapwork.utils.bindEvent(this._image,"mousedown",function(){r.onClick.apply(r,arguments)}),this._span=document.createElement("span"),this._span.style.position="absolute",this._span.style.right="10px",this._span.style.top="7px",this._span.innerText="刷新时间: "+n(),this._wrapDiv.appendChild(this._span)},openReloadTimer:function(){var e=this;this._timer&&(clearInterval(this._timer),this._timer=null),this._timer=setInterval(function(){e._trafficTileLayer&&e.refreshTrafficPage()},mapwork.trafficRefreshTime)},closeReloadTimer:function(){this._timer&&(clearInterval(this._timer),this._timer=null)},openTraffic:function(){var e=this._map.getLayer(mapwork.TileLayer.ID);e&&e.changeUrl(mapwork.mapStyle3),this._trafficTileLayer=this._map.getLayer(mapwork.TrafficTileLayer.ID),this._trafficTileLayer||(this._trafficTileLayer=new mapwork.TrafficTileLayer),this._map.addLayer(this._trafficTileLayer),this._trafficTileLayer.initLayer(),this._div.appendChild(this._wrapDiv),this.openReloadTimer()},closeTraffic:function(){this.closeReloadTimer(),this._trafficTileLayer=this._map.getLayer(mapwork.TrafficTileLayer.ID),this._trafficTileLayer&&this._map.removeLayer(this._trafficTileLayer),this._div.removeChild(this._wrapDiv),this._trafficTileLayer=null;var e=getCookie("mapStyle");e||(e=mapwork.mapStyle1,setCookie("mapStyle",e,999999));var t=this._map.getLayer(mapwork.TileLayer.ID);t&&t.changeUrl(e)},toggleTraffic:function(){return this._trafficButtonOpen=!this._trafficButtonOpen,this._trafficButtonOpen?this.openTraffic():this.closeTraffic(),this._trafficButtonOpen},onClick:function(e){return e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1),this._trafficButtonOpen&&this._trafficTileLayer&&this.refreshTrafficPage(),!1},refreshTrafficPage:function(){this._image.src="images/refresh.gif";var e=this;window.setTimeout(function(){e._image.src="images/refresh0.gif"},500),this._span.innerText="刷新时间: "+n(),this._trafficTileLayer.refreshPage()},createTrafficImage:function(e,n,r,i,s){var o=document.createElement("img");e&&(o.name=e),o.src=n,o.style.position="absolute",o.style.right=r+"px",o.style.top=i+"px",o.ondragstart=t;if(s){var u=this;mapwork.utils.bindEvent(o,"mousedown",function(){s.apply(u,arguments)})}return o}},e&&mapwork.utils.inherits(r,e)}(),function(){function t(){e&&e.apply(this,arguments),this._controlId=t.ID,this._div.style.zIndex=9900,this._div.style.position="absolute",this._div.style.right="10px",this._div.style.bottom="10px"}mapwork.MapScaleControl=t,t.ID="MapScaleControl";var e=mapwork.Control;t.prototype={setMap:function(e){this._map=e,this._scaleDiv=this.createDiv(this._div,"scalediv"),this._scaleDiv.style.position="absolute",this._scaleDiv.style.border="0px",this._scaleDiv.style.textAlign="center",this._scaleDiv.style.align="center",this._scaleDiv.style.borderColor="#000",this._scaleDiv.style.bottom="0px",this._scaleDiv.style.right="0px",this._scaleDiv.style.height="20px",this._scaleDiv.align="center",this._scaleLabel=this.createRelativeSpan(this._scaleDiv,"scaleLabel","",0,-15),this._scaleLabel.style.font='normal 12px "宋体",Verdana',this._scaleLabel.style.color="black",this._scaleLabel.align="center",this._scaleLabel.style.width="100%";var t=this.createDiv(this._scaleDiv,"scalediv");t.style.position="absolute",t.style.background="#000",t.style.width="100%",t.style.bottom="4px",t.style.height="2px",t.style.fontSize="0px",t.style.left="0px",t=this.createDiv(this._scaleDiv,"scalediv"),t.style.position="absolute",t.style.background="#000",t.style.width="1px",t.style.left="0px",t.style.height="10px",t.style.bottom="0px",t.style.fontSize="0px",t=this.createDiv(this._scaleDiv,"scalediv"),t.style.position="absolute",t.style.background="#000",t.style.width="1px",t.style.height="10px",t.style.bottom="0px",t.style.fontSize="0px",t.style.right="0px",this._map.addEventListener(mapwork.MapEvent.ZOOM_END,this.onReset,this),this._map.addEventListener(mapwork.MapEvent.MOVE_END,this.onReset,this),this._map.addEventListener(mapwork.MapEvent.RESIZE,this.onReset,this)},setRightLength:function(e){this._div.style.right=e+10+"px"},onReset:function(){var e=this._map.getMapLocation(),t=160,n=this._map.getSize();t>=n.width/3&&(t=parseInt(n.width/3));var r=e.getEdgeLen(),i=e.getMapCenterGlobalPos(),s=mapwork.MapRulerBuilder.createMapRuler(i,e.getZoom(),r,t);s?(this._scaleDiv.style.display="block",this._scaleLabel.innerText=s.metricText,mapwork.isFirefox&&(this._scaleLabel.textContent=s.metricText),s.metricLength&&(this._scaleDiv.style.width=s.metricLength+"px"),this._scaleDiv.align="center"):this._scaleDiv.style.display="none"}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._controlId=t.ID,this._div.style.zIndex=9800,this._div.style.position="absolute",this._div.style.left="5px",this._div.style.bottom="5px"}mapwork.MapPosInfoControl=t,t.ID="MapPosInfoControl";var e=mapwork.Control;t.prototype={setMap:function(e){this._map=e,this._posInfoLabel=this.createRelativeSpan(this._div,"posInfoLabel"),this._posInfoLabel.style.display="inline",this._posInfoLabel.style.font="normal 12px 宋体,Verdana",this._posInfoLabel.style.color="black",this._posInfoLabel.style["float"]="left",this._posInfoLabel.style.padding="1px",this._posInfoLabel.style.background="white",this._posInfoLabel.style.cursor="default",this._map.addEventListener(mapwork.MapEvent.ZOOM_END,this.onMapReset,this),this._map.addEventListener(mapwork.MapEvent.MOVING,this.onMapReset,this),this._map.addEventListener(mapwork.MapEvent.MOVE_END,this.onMapReset,this),this._map.addEventListener(mapwork.MapEvent.RESIZE,this.onMapReset,this)},onMapReset:function(){var e=this._map.getMapLocation(),t=e.getMapCenterEarthPos(),n="Center:("+t.getLatLonString()+")["+e.getCenterTileId()+"]";this._posInfoLabel.innerText=n}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._controlId=t.ID,this._div1=document.createElement("div"),this._div1.style.position="absolute",this._div1.style.zIndex=1003,this._div1.style.borderTop="2px solid #f00",this._div1.style.borderLeft="2px solid #f00",this._div1.style.width="10px",this._div1.style.height="10px",this._div2=document.createElement("div"),this._div2.style.zIndex=1003,this._div2.style.position="absolute",this._div2.style.borderBottom="2px solid #f00",this._div2.style.borderRight="2px solid #f00",this._div2.style.width="10px",this._div2.style.height="10px",this._div3=document.createElement("div"),this._div3.style.position="absolute",this._div3.style.zIndex=1003,this._div3.style.borderBottom="2px solid #f00",this._div3.style.borderLeft="2px solid #f00",this._div3.style.width="10px",this._div3.style.height="10px",this._div4=document.createElement("div"),this._div4.style.zIndex=1003,this._div4.style.position="absolute",this._div4.style.borderTop="2px solid #f00",this._div4.style.borderRight="2px solid #f00",this._div4.style.width="10px",this._div4.style.height="10px",this._wheelFocusTime=null,this._wheelFocusX=0,this._wheelFocusY=0,this._wheelFocusLen=0,this._isZoomUp=!1,this.disableDivs()}mapwork.WheelRectControl=t,t.ID="WheelRectControl";var e=mapwork.Control;t.prototype={appendToDiv:function(e){e.appendChild(this._div1),e.appendChild(this._div2),e.appendChild(this._div3),e.appendChild(this._div4)},redraw:function(){this._div1.style.left=this._wheelFocusX-this._wheelFocusLen+"px",this._div1.style.top=this._wheelFocusY-this._wheelFocusLen+"px",this._div2.style.left=this._wheelFocusX+this._wheelFocusLen+"px",this._div2.style.top=this._wheelFocusY+this._wheelFocusLen+"px",this._div3.style.left=this._wheelFocusX-this._wheelFocusLen+"px",this._div3.style.top=this._wheelFocusY+this._wheelFocusLen+"px",this._div4.style.left=this._wheelFocusX+this._wheelFocusLen+"px",this._div4.style.top=this._wheelFocusY-this._wheelFocusLen+"px"},doWheelFocus:function(e,t,n){this._isZoomUp=e,this._wheelFocusX=t,this._wheelFocusY=n,this._wheelFocusLen=30,this._div1.style.display="block",this._div2.style.display="block",this._div3.style.display="block",this._div4.style.display="block";if(!this._wheelFocusTime){var r=this;function i(){r.doWheelFocusIt()}this._wheelFocusTime=setInterval(i,100)}},disableDivs:function(){this._div1.style.display="none",this._div1.style.left="-1000px",this._div1.style.top="-1000px",this._div2.style.display="none",this._div2.style.left="-1000px",this._div2.style.top="-1000px",this._div3.style.display="none",this._div3.style.left="-1000px",this._div3.style.top="-1000px",this._div4.style.display="none",this._div4.style.left="-1000px",this._div4.style.top="-1000px"
},doWheelFocusIt:function(){this._isZoomUp?this._wheelFocusLen-=3:this._wheelFocusLen+=3,this.redraw(),(this._wheelFocusLen>=40||this._wheelFocusLen<20)&&this._wheelFocusTime&&(clearInterval(this._wheelFocusTime),this._wheelFocusTime=null,this.redraw(),this.disableDivs())}},e&&mapwork.utils.inherits(t,e)}(),function(){function n(){e&&e.apply(this,arguments),this._controlId=n.ID,this._div.style.zIndex=9800,this._div.style.position="absolute",this._div.style.border="1px solid #E88C2B",this._div.style.backgroundColor="rgba(232, 140, 43, 0.5)",this._div.style.left="-1000px",this._div.style.top="-1000px",this._div.style.width="0px",this._div.style.height="0px"}mapwork.DragRectControl=n,n.ID="DragRectControl";var e=mapwork.Control;n.doDragRect=!1;var t=mapwork.utils;n.prototype={startDrag:function(e){function i(e){n.draggingDiv.call(n,e)}function s(e){n.droppedDiv.call(n,e)}var n=this;if(mapwork.isIE)this._pageX=e.x,this._pageY=e.y;else{var r=this._map.getMapLocation();this._pageX=e.clientX-r._map._div.offsetLeft,this._pageY=e.clientY-r._map._div.offsetTop}this._div.style.display="block",this._div.style.left=this._pageX+"px",this._div.style.top=this._pageY+"px",this._div.style.width="0px",this._div.style.height="0px",this.draggingFunc=i,this.droppedFunc=s,t.bindEvent(document,"mousemove",i),t.bindEvent(document,"mouseup",s)},draggingFunc:function(e){this.draggingDiv.call(this,e)},draggingDiv:function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1);var t,n;if(mapwork.isIE)t=e.x,n=e.y;else{var r=this._map.getMapLocation();t=e.clientX-r._map._div.offsetLeft,n=e.clientY-r._map._div.offsetTop}this._div.style.left=Math.min(this._pageX,t)+"px",this._div.style.top=Math.min(this._pageY,n)+"px",this._div.style.width=Math.abs(t-this._pageX)+"px",this._div.style.height=Math.abs(n-this._pageY)+"px"},droppedDiv:function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1),t.unbindEvent(document,"mousemove",this.draggingFunc),t.unbindEvent(document,"mouseup",this.droppedFunc);var r,i;if(mapwork.isIE)r=e.x,i=e.y;else{var s=this._map.getMapLocation();r=e.clientX-s._map._div.offsetLeft,i=e.clientY-s._map._div.offsetTop}this._div.style.display="none",this._div.style.left="-1000px",this._div.style.top="-1000px",this._div.style.width="0px",this._div.style.height="0px",this.zoomToRect(this._pageX,this._pageY,r,i),n.doDragRect=!1,this._map.fireEvent(mapwork.MapEvent.DRAGSTATUS_CHANGE,this._map)},zoomToRect:function(e,t,n,r){if(Math.abs(n-e)!=0&&Math.abs(r-t)!=0){var i=Math.min(e,n),s=Math.min(t,r),o=Math.max(e,n),u=Math.max(t,r),a=this._map.getMapLocation(),f=a.getGlobalPosFromMapPos(i,s),l=a.getGlobalPosFromMapPos(o,u),c=new mapwork.Bounds;c.expandToIncludePoint(f.getPosX(),f.getPosY()),c.expandToIncludePoint(l.getPosX(),l.getPosY()),this._map.fitBounds(c)}}},e&&mapwork.utils.inherits(n,e)}(),function(){function n(t){e&&e.apply(this,arguments),this._width=125,this._height=125,this._controlId=n.ID,this._div.style.zIndex=9900,this._div.style.position="absolute",this._div.style.border="2px solid #84A9D2",this._div.style.backgroundColor="#FFF",this._div.style.overflow="hidden",this._div.style["-webkit-user-select"]="none",this._div.style.right="0px",this._div.style.bottom="0px",this._bgRect=new mapwork.MapShadowRect("MapShadowRect"),t?this._isOpen=!0:this._isOpen=!1}mapwork.OverviewControl=n,n.ID="OverviewControl";var e=mapwork.Control,t=mapwork.utils;n.prototype={setMap:function(e){this._map=e,this._mapLocation=e.getMapLocation(),this.createOverviewMap(),this.createToggleButton(),this.resetBGMap(),this.resetCurrectMapSizeRect(),this._isOpen?(this._div.style.width=this._width+"px",this._div.style.height=this._height+"px",this._toggleImage.style.left="0px",this._toggleImage.style.top="0px"):(this._div.style.width="17px",this._div.style.height="17px",this._toggleImage.style.left="-19px",this._toggleImage.style.top="0px"),t.bindEvent(this._div,"mousedown",function(e){if(e.stopPropagation){e.stopPropagation(),e.preventDefault();if(e.button!=0)return}else{e.cancelBubble=!0,e.returnValue=!1;if(e.button!=1)return}}),t.bindEvent(this._div,"click",function(e){if(e.stopPropagation){e.stopPropagation(),e.preventDefault();if(e.button!=0)return}else{e.cancelBubble=!0,e.returnValue=!1;if(e.button!=1)return}}),this._mapScaleControl=this._map.getControl(mapwork.MapScaleControl.ID),this.setScaleControlOffset(),this._map.addEventListener(mapwork.MapEvent.RESIZE,this.onMapResize,this),this._map.addEventListener(mapwork.MapEvent.MOVING,this.onMapMoving,this),this._map.addEventListener(mapwork.MapEvent.MOVE_END,this.onMapMoved,this),this._map.addEventListener(mapwork.MapEvent.ZOOM_END,this.onMapZoom,this)},createOverviewMap:function(){var e=this;this._oMap=new mapwork.Map(this._div,{zoom:e._mapLocation.getZoom()-4}),this._oMapLocation=this._oMap.getMapLocation(),this._oMapLocation._minZoom-=4;var n=new mapwork.TileLayer("tileLayer");this._oMap.addLayer(n),this._layerContainer=this._oMap.getLayerContainer(),this._shadowLayer=this._layerContainer.getLayer(mapwork.MapShadowLayer.ID),this._shadowLayer.addElement(this._bgRect),mapwork.isIE?this._bgRect.setStyle({position:"absolute",border:"1px solid #f00",backgroundColor:"#f00",filter:"alpha(opacity=40)"}):this._bgRect.setStyle({position:"absolute",border:"1px solid #f00",backgroundColor:"#f00",opacity:.4}),this._rectFGDiv=document.createElement("div"),this._rectFGDiv.style.position="absolute",this._rectFGDiv.style.border="2px solid #000",this._rectFGDiv.style.zIndex=1e4;var r=document.createElement("div");r.style.position="absolute",r.style.backgroundColor="#fff",r.style.opacity=.01,this._rectFGDiv.appendChild(r),this._div.appendChild(this._rectFGDiv);var e=this;t.bindEvent(this._rectFGDiv,"mousedown",function(t){e.onMouseDown.call(e,t)})},createToggleButton:function(){var e=document.createElement("div");e.style.position="absolute",e.style.width="19px",e.style.height="19px",e.style.right="-1px",e.style.bottom="-1px",e.style.overflow="hidden",e.style.zIndex=1e4,this._div.appendChild(e),this._toggleImage=document.createElement("img"),e.appendChild(this._toggleImage),this._toggleImage.style.left="0px",this._toggleImage.style.top="0px",this._toggleImage.src="images/eagleeyerect.png",this._toggleImage.style.position="absolute";var n=this;t.bindEvent(e,"mouseup",function(e){if(e.stopPropagation){e.stopPropagation(),e.preventDefault();if(e.button!=0)return}else{e.cancelBubble=!0,e.returnValue=!1;if(e.button!=1)return}n.doToggle()})},getDivBounds:function(){var e=$(this._div),t=e.offset(),n=e.width(),r=e.height();return new mapwork.Bounds(t.left,t.top,t.left+n,t.top+r)},getFGRectBounds:function(){var e=$(this._rectFGDiv),t=e.offset(),n=e.width(),r=e.height();return new mapwork.Bounds(t.left,t.top,t.left+n,t.top+r)},getFGRectCenterGPos:function(e,t){var n=t.getCenterX()-e.getMinX(),r=t.getCenterY()-e.getMinY(),i=this._oMapLocation.getGlobalPosFromMapPos(n,r);return i},setScaleControlOffset:function(){this._isOpen?this._mapScaleControl&&this._mapScaleControl.setRightLength(130):this._mapScaleControl&&this._mapScaleControl.setRightLength(20)},doToggle:function(){if(this._isOpen)this._isOpen=!this._isOpen,this._toggleImage.style.left="-19px",this._toggleImage.style.top="0px",this._div.style.width="17px",this._div.style.height="17px";else{this._isOpen=!this._isOpen;var e=this._mapLocation.getMapCenterGlobalPos(),t=this._mapLocation.getZoom()-4;this._oMap.zoomToMapCenter(e,t);var n=this._mapLocation.getWindowLeftTopGlobalPos(),r=this._mapLocation.getWindowRightBottomGlobalPos();this._bgRect.setLeftTopGlobalPos(n),this._bgRect.setRightBottomGlobalPos(r),this._toggleImage.style.left="0px",this._toggleImage.style.top="0px",this._div.style.width=this._width+"px",this._div.style.height=this._height+"px",this._shadowLayer.initLayer(),this.resetCurrectMapSizeRect()}this.setScaleControlOffset()},resetBGMap:function(){var e=this._map.getMapLocation(),t=e.getWindowLeftTopGlobalPos(),n=e.getWindowRightBottomGlobalPos();this._bgRect.setLeftTopGlobalPos(t),this._bgRect.setRightBottomGlobalPos(n),this._shadowLayer.initLayer()},resetCurrectMapSizeRect:function(e,t){e||(e=0),t||(t=0);var n=this._map.getSize(),r=n.width/16,i=n.height/16;this._rectFGDiv.style.width=r+"px",this._rectFGDiv.style.height=i+"px",this._rectFGDiv.style.left=this._width/2-r/2+e+"px",this._rectFGDiv.style.top=this._height/2-i/2+t+"px"},onMapMoving:function(){if(!this._isOpen)return;var e=this._map.getMapLocation(),t=e.getMapCenterGlobalPos();this._oMap.movingToMapCenter(t)},onMapMoved:function(){var e=this._map.getMapLocation(),t=e.getMapCenterGlobalPos();this._oMap.movedToMapCenter(t),this.resetBGMap(),this.resetCurrectMapSizeRect()},onMapResize:function(){this._oMap.resetSize({width:this._width,height:this._height});if(!this._isOpen)return;this.resetBGMap(),this.resetCurrectMapSizeRect()},onMapZoom:function(){if(!this._isOpen)return;var e=this._map.getMapLocation(),t=e.getMapCenterGlobalPos(),n=e.getZoom()-4;this._oMap.zoomToMapCenter(t,n),this.resetBGMap(),this.resetCurrectMapSizeRect()},doMoving:function(e,t){function r(){n._layerContainer.movingMap(-n._movingOffsetX,-n._movingOffsetY)}this._movingOffsetX=e,this._movingOffsetY=t;var n=this;this._movingInterval||(this._movingInterval=setInterval(r,1))},stopMoving:function(){this._movingInterval&&(clearInterval(this._movingInterval),this._movingInterval=null)},onMouseDown:function(e){if(e.stopPropagation){e.stopPropagation(),e.preventDefault();if(e.button!=0)return}else{e.cancelBubble=!0,e.returnValue=!1;if(e.button!=1)return}var n=t.getPageX(e),r=t.getPageY(e),i=this,s=function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1);var s=t.getPageX(e),o=t.getPageY(e);i.resetCurrectMapSizeRect(s-n,o-r);var u=i.getDivBounds(),a=i.getFGRectBounds();if(!u.containBounds(a)){var f=0,l=0;a.getMinX()<u.getMinX()?f=-1:a.getMaxX()>u.getMaxX()&&(f=1),a.getMinY()<u.getMinY()?l=-1:a.getMaxY()>u.getMaxY()&&(l=1),f!=0||l!=0?i.doMoving(f,l):i.stopMoving()}else i.stopMoving()},o=function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1),t.unbindEvent(document,"mousemove",s),t.unbindEvent(document,"mouseup",o);var n=i.getDivBounds(),r=i._bgRect.getPixelBounds(),u=i.getFGRectBounds(),a=i.getFGRectCenterGPos(n,u);n.containBounds(u)?r.intersectBounds(u)?i._map.slidingToMapCenter(a,function(){i.resetCurrectMapSizeRect()}):(i._map.movedToMapCenter(a),i.resetCurrectMapSizeRect()):(i.stopMoving(),i._map.movedToMapCenter(a),i.resetCurrectMapSizeRect())};t.bindEvent(document,"mousemove",s),t.bindEvent(document,"mouseup",o)}},e&&mapwork.utils.inherits(n,e)}(),function(){function t(){e&&e.apply(this,arguments),this._controlId=t.ID,this._div.style.zIndex=9800}mapwork.MapChannelInfoControl=t,t.ID="MapChannelInfoControl";var e=mapwork.Control;t.prototype={addItem:function(e,t,n,r){},init:function(e){this._router=e;var t=this._router._currRouterLine._jsonData,n=t.poi;$(this._div).find(".ctrl_menu").empty();for(var r in n){var i=n[r],s=i.type,o=i.name,u=i.items.length;this._$Menu.append("		<li name='"+s+"'>"+"			<span class='itemCheck'></span>"+"			<span class='icon' style='background:url(images/"+s+".png)'></span>"+"			<span class='name'>"+o+"<span>"+"			<span class='number'>"+u+"个</span>"+"		</li>"),u==0&&this._$Menu.find("li:last").addClass("itemDisabled")}var a=this;this._$Menu.find("li:not(.itemDisabled)").each(function(){$(this).hover(function(){$(this).addClass("on"),$(this).find(".itemCheck").addClass("on")},function(){$(this).removeClass("on"),$(this).find(".itemCheck").removeClass("on")}),$(this).click(function(){$(this).find(".itemCheck").toggleClass("click");var e=!1;$(this).find(".itemCheck").hasClass("click")&&(e=!0),a._router.showPOI($(this).attr("name"),e)})}),this.show()},setMap:function(e){this._map=e,$(this._div).addClass("channelInfoControl"),$(this._div).append("<div class='title'>途经信息</div><div class='content'>	<ul class='ctrl_menu'>	</ul>	<div class='drop'>		<img src='images/drapdown.png'/>	</div></div>");var t=this;$(this._div).find(".title,.drop").click(function(){var e=$(t._div).find(".drop > img"),n=250;$(t._$Menu).css("display")!="none"?($(t._div).animate({width:"60px",height:"31px"},n),t._$Menu.hide(),e.attr("src","images/drapdown.png")):($(t._div).animate({width:"160px",height:"118px"},n),t._$Menu.show(n),e.attr("src","images/drapup.png"))}),this._$Menu=$(this._div).find(".ctrl_menu")},show:function(){$(this._div).show()},hide:function(){$(this._div).hide()}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._controlId=t.ID,this._div.style.zIndex=9800}mapwork.RuleControl=t,t.ID="RuleControl";var e=mapwork.Control;t.prototype={init:function(){this.show()},setMap:function(e){this._map=e},show:function(){$(this._div).show()},hide:function(){$(this._div).hide()}},e&&mapwork.utils.inherits(t,e)}(),function(){function n(){this._controlId=n.ID,this._div.style.zIndex=9800,this._div.style.position="absolute",this._div.style.border="1px solid #E88C2B",this._div.style.backgroundColor="rgba(232, 140, 43, 0.5)",this._div.style.left="100px",this._div.style.top="100px",this._div.style.width="200px",this._div.style.height="200px"}mapwork.MapBlockControl=n,n.ID="MapBlockControl";var e=mapwork.Control,t=mapwork.utils;e&&mapwork.utils.inherits(n,e)}(),function(){function r(r){e&&e.apply(this,arguments),this._id=r,this._elementId=t+"_"+n,t++,t>1e8&&(n++,t=0),this._htmlObj=null}mapwork.MapElement=r;var e=null,t=0,n=0;r.prototype={getElementId:function(){return this._elementId},getId:function(){return this._id},getLayer:function(){return this._layer},setLayer:function(e){this._layer=e},getHtmlObj:function(){return this._htmlObj},doRemove:function(){this._layer&&this._layer.removeElement(this)},show:function(){this._htmlObj.style.display="block"},hide:function(){this._htmlObj.style.display="none"},updateMapPos:function(e,t,n,r){},updateMapZoom:function(e){}},e&&mapwork.utils.inherits(r,e)}(),function(){function t(t,n,r,i){e&&e.apply(this,arguments),this._id=t,i?this._offsetPos=i:i=[0,0],this._div=document.createElement("div"),this._div.style.position="absolute",this._div.style.whiteSpace="nowrap",this._div.style.border="1px solid #4C4C4C",this._div.style.padding="2px 7px",this._div.style["-webkit-box-shadow"]="rgb(160, 160, 160) 2px 2px 8px",this._div.style["box-shadow"]="rgb(160, 160, 160) 2px 2px 8px",this._div.style.lineHeight="15px",this._div.style.fontWeight="bold",this._div.style.backgroundColor="#FFF",this._div.style.borderRadius="5px",this._htmlObj=this._div,this._contentDiv=document.createElement("div"),this._div.appendChild(this._contentDiv),this._labelSpan=document.createElement("span"),this._labelSpan.style.backgroundColor="#FFF",this._labelSpan.style.fontSize="12px",this._labelSpan.style.cursor="default",this._contentDiv.appendChild(this._labelSpan),this.setName(n),r&&this.setPos(r)}mapwork.MapLabel=t;var e=mapwork.MapElement;t.prototype={setName:function(e){this._labelSpan.innerHTML=e},getName:function(){return this._labelSpan.innerHTML},setPos:function(e){if(e instanceof mapwork.EarthPos){var t=e.convert2GlobalPos();t&&(this._gPos=t,this._ePos=e),this._div.style.display="block"}else if(e instanceof mapwork.GlobalPos){var n=e.convert2EarthPos();n&&(this._gPos=e,this._ePos=n),this._div.style.display="block"}},getEarthPos:function(){return this._ePos},getGlobalPos:function(){return this._gPos},updateMapPos:function(e,t,n,r){var i=e.width/2+t*(this._gPos.posX-n.posX)-r[0],s=e.height/2+t*(this._gPos.posY-n.posY)-r[1];this._offsetPos&&(i+=this._offsetPos[0],s+=this._offsetPos[1]),this._div.style.left=i+"px",this._div.style.top=s+"px"}},e&&mapwork.utils.inherits(t,e)}(),function(){function r(e,n,r,i,s){t&&t.apply(this,arguments),this._zIndex=s,this._defaultIcon=n,this._hoverIcon=r,this._offsetPos=i,this.init()}mapwork.MapIcon=r;var e=mapwork.utils,t=mapwork.MapElement,n=100;r.prototype={init:function(){this._htmlObj=document.createElement("img"),this._htmlObj.style.position="absolute",this._htmlObj.style.cursor="pointer",this.setIcon(this._defaultIcon),this._zIndex!=undefined&&(this._htmlObj.style.zIndex=this._zIndex)},setIcon:function(e){typeof e=="string"?this._htmlObj.src=e:e instanceof mapwork.SpriteImage&&e.wrapImage(this._htmlObj)},setHoverImage:function(){this._zIndex!=undefined&&(this._htmlObj.style.zIndex=101)},setDefaultImage:function(){this._zIndex!=undefined&&(this._htmlObj.style.zIndex=this._zIndex)},setContent:function(e){this._content=e},getEarthPos:function(){return this._ePos},getGlobalPos:function(){return this._gPos},setEarthPos:function(e){if(e){var t=e.convert2GlobalPos();t&&(this._gPos=t,this._ePos=e),this._htmlObj.style.display="block"}},setPos:function(e){if(e instanceof mapwork.EarthPos){var t=e.convert2GlobalPos();t&&(this._gPos=t,this._ePos=e),this._htmlObj.style.display="block"}else if(e instanceof mapwork.GlobalPos){var n=e.convert2EarthPos();n&&(this._gPos=e,this._ePos=n),this._htmlObj.style.display="block"}},updateMapPos:function(e,t,n,r){var i=e.width/2+t*(this._gPos.posX-n.posX)-r[0],s=e.height/2+t*(this._gPos.posY-n.posY)-r[1];this._offsetPos&&(i-=this._offsetPos[0],s-=this._offsetPos[1]),this._htmlObjPos=[i,s],this._htmlObj.style.left=i+"px",this._htmlObj.style.top=s+"px"},setFocus:function(){this.setHoverImage()},clearFocus:function(){this.setDefaultImage()},doClickFocus:function(){console.log("cccc")},doFocus:function(){this.setHoverImage(),this._htmlObj.style.zIndex=n},doDeFocus:function(){this.setDefaultImage(),this._htmlObj.style.zIndex=0},addEventListener:function(t,n,r,i){e.bindEvent(this._htmlObj,t,function(e){n.call(r,e,i)})}},t&&mapwork.utils.inherits(r,t)}(),function(){function n(){e&&e.apply(this,arguments),this._bindDraggableEvent()}mapwork.MapDraggableIcon=n;var e=mapwork.MapIcon,t=mapwork.utils;n.prototype={_bindDraggableEvent:function(){var e=this;mapwork.utils.bindEvent(this._htmlObj,"mousedown",function(t){e.onMouseDown(t)})},setDraggedFunc:function(e){this._draggedFunc=e},setShadowIcon:function(e){this._shadowIcon=e},onMouseDown:function(e){if(this._layer._map.getMode()!=0)return;this._pressX=t.getPageX(e),this._pressY=t.getPageY(e);if(e.stopPropagation){e.stopPropagation(),e.preventDefault();if(e.button!=0)return}else{e.cancelBubble=!0,e.returnValue=!1;if(e.button!=1)return}var n=this;this._isDragged=!1;var r=function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1);var r=t.getPageX(e),i=t.getPageY(e);n._isDragged=!0,n._htmlObj.style.left=n._htmlObjPos[0]+r-n._pressX+"px",n._htmlObj.style.top=n._htmlObjPos[1]+i-n._pressY+"px";var s=n._shadowIcon;s&&(s._htmlObj.style.left=s._htmlObjPos[0]+r-n._pressX+"px",s._htmlObj.style.top=s._htmlObjPos[1]+i-n._pressY+"px")},i=function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1),mapwork.utils.unbindEvent(document,"mousemove",r),mapwork.utils.unbindEvent(document,"mouseup",i);if(n._isDragged){var s=n._layer._map.getMapLocation(),o=s.getEdgeLen(),u=t.getPageX(e),a=t.getPageY(e),f=n._gPos.posX+(u-n._pressX)/o,l=n._gPos.posY+(a-n._pressY)/o,c=(new mapwork.GlobalPos(f,l)).convert2EarthPos();n.setEarthPos(c),n._htmlObjPos=[n._htmlObjPos[0]+u-n._pressX,n._htmlObjPos[1]+a-n._pressY],n._htmlObj.style.left=n._htmlObjPos[0]+"px",n._htmlObj.style.top=n._htmlObjPos[1]+"px",n._draggedFunc&&n._draggedFunc.call(n,c)}};mapwork.utils.bindEvent(document,"mousemove",r),mapwork.utils.bindEvent(document,"mouseup",i)}},e&&mapwork.utils.inherits(n,e)}(),function(){function t(){e&&e.apply(this,arguments),this._div=document.createElement("div"),this._htmlObj=this._div,this._ltGPos=null,this._rbGPos=null}mapwork.MapShadowRect=t;var e=mapwork.MapElement;t.prototype={setStyle:function(e){if(e)for(var t in e)this._div.style[t]=e[t]},getLeftTopGlobalPos:function(){return this._ltGPos},setLeftTopGlobalPos:function(e){this._ltGPos=e},getRightBottomGlobalPos:function(){return this._rbGPos},setRightBottomGlobalPos:function(e){this._rbGPos=e},updateMapPos:function(e,t,n,r){if(this._ltGPos&&this._rbGPos){var i=e.width/2+t*(this._ltGPos.posX-n.posX)-r[0],s=e.height/2+t*(this._ltGPos.posY-n.posY)-r[1],o=e.width/2+t*(this._rbGPos.posX-n.posX)-r[0],u=e.height/2+t*(this._rbGPos.posY-n.posY)-r[1];this._p1x=i,this._p1y=s,this._div.style.left=i+"px",this._div.style.top=s+"px",this._div.style.width=o-i+"px",this._div.style.height=u-s+"px"}},setPixelOffset:function(e,t){this._div.style.left=this._p1x+e+"px",this._div.style.top=this._p1y+t+"px"},getPixelBounds:function(){var e=$(this._div),t=e.offset(),n=e.width(),r=e.height();return new mapwork.Bounds(t.left,t.top,t.left+n,t.top+r)}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(t,n,r,i,s){e&&e.apply(this,arguments),this.init()}mapwork.MapIconLabel=t;var e=mapwork.MapIcon;t.prototype={init:function(){this._htmlObj=document.createElement("div"),this._htmlObj.style.position="absolute",this._htmlObj.style.textAlign="center",this._image=document.createElement("img"),this._htmlObj.appendChild(this._image),this._labelDiv=document.createElement("p"),this._labelDiv.style.backgroundColor="#FFF",this._labelDiv.style.fontSize="12px",this._labelDiv.style.cursor="default",this._htmlObj.appendChild(this._labelDiv),this.setIcon(this._defaultIcon),this._zIndex!=undefined&&(this._htmlObj.style.zIndex=this._zIndex)},setIcon:function(e){typeof e=="string"?this._image.src=e:e instanceof mapwork.SpriteImage&&e.wrapImage(this._image)},setLabel:function(e){this._labelDiv.innerHTML=e},setHoverImage:function(){this.setIcon(this._hoverIcon),this._zIndex!=undefined&&(this._htmlObj.style.zIndex=101),this._labelDiv.style.fontWeight="bold"},setDefaultImage:function(){this.setIcon(this._defaultIcon),this._zIndex!=undefined&&(this._htmlObj.style.zIndex=this._zIndex),this._labelDiv.style.fontWeight="normal"}},e&&mapwork.utils.inherits(t,e)}(),function(){function n(e){t&&t.apply(this,arguments),this._map=e,this._tipDiv=document.createElement("div"),this._tipDiv.className="tips_02",this._tipDiv.id="tips_02",this._tipDiv.style.display="none",this._htmlObj=this._tipDiv,mapwork.utils.bindEvent(this._tipDiv,"mousedown",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0})}mapwork.MapTip=n;var e='<div class="tips_jt" id="tips_jt"><img src="images/bg_tips_04.png" class="png"></div><div class="tips_box"><div class="tips_top"></div><div class="tips_close" id="tips_close"><img src="images/tips_close_02.gif"></div><div class="tips_main"><div class="tips_content"></div><div class="tips_tail"></div></div>',t=mapwork.MapElement;n.prototype={setTrigger:function(e){this._trigger=e},getTrigger:function(){return this._trigger},open:function(e,t,n,r,i,s){this._tipDiv.style.display="none";if(!e)return;this._closeCallback=s,this._offsetTop=i,this._offsetTop||(this._offsetTop=0),this._isInit||this.initTip(),this._shadowIcon||this.initShadow(),this._tipEPos=e,this._tipGPos=e.convert2GlobalPos(),this._$TipTop.empty(),t&&this._$TipTop.append(t),this._$TipContent.empty(),n&&this._$TipContent.append(n),this._$TipTail.empty(),r&&this._$TipTail.append(r),this._tipDiv.style.display="block",this.showShadow(),this._layer.resetElement(this),this.fitWindow()},fitWindow:function(){var e=this._map.getMapLocation(),t=this._map.getSize(),n=e.getWindowPixelBounds(),r=this.getTipPixelPos(),i=this.getTipBounds();if(!n.containBounds(i)){n.expandBy(200,200);if(n.containPoint(r[0],r[1])){var s=n.getCenterX(),o=n.getCenterY();i.getHeight()>t.height/2&&(r[1]-=i.getHeight()-t.height/2+5);var u=s-r[0],a=o-r[1],f=50,l=u/f,c=a/f,h=this._map.getLayerContainer(),p=0;function d(){h.movedMap(l,c),p++,p>=f&&v&&(clearInterval(v),v=null)}var v=setInterval(d,1)}else{var m=this._tipGPos;if(i.getHeight()>t.height/2){var g=m.getPosX(),y=m.getPosY(),b=e.getEdgeLen();y-=(i.getHeight()-t.height/2+5)/b,m=new mapwork.GlobalPos(g,y)}this._map.movedToMapCenter(m)}}},initShadow:function(){var e="shadow",t="images/bg_tips_03.png",n=null,r=[190,172+this._offsetTop];this._shadowIcon=new mapwork.MapIcon(e,t,n,r),this._mapShadowLayer=this._map.getLayer(mapwork.MapShadowLayer.ID),this._mapShadowLayer.addElement(this._shadowIcon)},showShadow:function(){this._tipEPos&&(this._shadowIcon.setEarthPos(this._tipEPos),this._shadowIcon.show(),this._mapShadowLayer.initLayer())},initTip:function(){this._isInit=!0,this._tipDiv.innerHTML=e,this._$TipTop=$(this._tipDiv).find(".tips_top"),this._$TipContent=$(this._tipDiv).find(".tips_content"),this._$TipTail=$(this._tipDiv).find(".tips_tail");var t=this;$("#tips_close").click(function(e){t.doHide(),t._closeCallback&&t._closeCallback.call()})},getTipBounds:function(){var e=this._tipDiv.clientWidth,t=this._tipDiv.clientHeight,n=this._map.getMapLocation(),r=n.getEdgeLen(),i=r*this._tipGPos.posX,s=r*this._tipGPos.posY,o=i-182,u=i-182+e,a=s-t-this._offsetTop,f=s;return new mapwork.Bounds(o,a,u,f)},getTipPixelPos:function(){var e=this._map.getMapLocation(),t=e.getEdgeLen(),n=t*this._tipGPos.posX,r=t*this._tipGPos.posY;return[n,r]},doHide:function(){this._shadowIcon&&(this._tipDiv.style.display="none",this._shadowIcon.hide())},isDisplay:function(){return this._tipDiv.style.display!="none"},updateMapPos:function(e,t,n,r){if(this._tipGPos){var i=this._tipDiv.clientHeight,s=e.width/2+t*(this._tipGPos.posX-n.posX)-r[0]-182,o=e.height/2+t*(this._tipGPos.posY-n.posY)-r[1]-i-this._offsetTop;this._tipDiv.style.left=s+"px",this._tipDiv.style.top=o+"px"}}},t&&mapwork.utils.inherits(n,t)}(),function(){function t(t){e&&e.apply(this,arguments),mapwork.supportSVG?(this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.style.zIndex=1,this._svg.style.position="absolute",this._svg.setAttribute("version","1.1"),this._svg.setAttribute("type","system"),this._svg.setAttribute("baseProfile","full"),this._svg.setAttribute("pointer-events","none"),this._htmlObj=this._svg,this._element=document.createElementNS("http://www.w3.org/2000/svg","path"),this._element.setAttribute("stroke-width",4),this._element.setAttribute("stroke-dasharray","solid"),this._element.setAttribute("stroke-linejoin","round"),this._element.setAttribute("stroke-linecap","round"),this._element.setAttribute("stroke","#0099ff"),this._element.setAttribute("fill","none"),this._element.setAttribute("pointer-events","auto"),this._element.setAttribute("stroke-opacity","1.0"),this._svg.appendChild(this._element)):(this._element=document.createElement("v:shape"),this._element.style.zIndex=1,this._element.style.position="absolute",this._element.style.top="0px",this._element.style.left="0px",this._element.style.width="1000px",this._element.style.height="1000px",this._element.strokeWeight="4px",this._element.strokeColor="#0099ff",this._element.filled="false",this._elementStroke=document.createElement("v:stroke"),this._elementStroke.endcap="round",this._element.appendChild(this._elementStroke),this._htmlObj=this._element),this._ePosList=[],this._gPosList=[]}mapwork.MapPath=t;var e=mapwork.MapElement;t.prototype={setZIndex:function(e){mapwork.supportSVG?this._svg.style.zIndex=e:this._element.style.zIndex=e},setDash:function(e){mapwork.supportSVG?this._element.setAttribute("stroke-dasharray",e):this._elementStroke.dashstyle="ShortDash"},setWidth:function(e){mapwork.supportSVG?this._element.setAttribute("stroke-width",e):this._element.strokeWeight=e+"px"},setOpacity:function(e){mapwork.supportSVG?this._element.setAttribute("stroke-opacity",e):this._elementStroke.opacity=e},setColor:function(e){mapwork.supportSVG?this._element.setAttribute("stroke",e):this._element.strokeColor=e},setSVGAttr:function(e,t){this._svg.setAttribute(e,t)},setSVGElementAttr:function(e,t){this._element.setAttribute(e,t)},addPos:function(e){e instanceof mapwork.EarthPos?(this._ePosList.push(e),this._gPosList.push(e.convert2GlobalPos())):e instanceof mapwork.GlobalPos&&(this._gPosList.push(e),this._ePosList.push(e.convert2EarthPos()))},setEPosArray:function(e){this._ePosList=[],this._gPosList=[],this._ePosList=e;for(var t in e){var n=e[t];this._gPosList.push(n.convert2GlobalPos())}},setGPosArray:function(e){this._ePosList=[],this._gPosList=[],this._gPosList=e;for(var t in e){var n=e[t];this._ePosList.push(n.convert2EarthPos())}},clearPosList:function(){this._ePosList=[],this._gPosList=[]},getPosCount:function(){return this._ePosList.length},changeLastPos:function(e){this._ePosList.length>0&&(this._gPosList.pop(),e instanceof mapwork.EarthPos?(this._ePosList.push(e),this._gPosList.push(e.convert2GlobalPos())):e instanceof mapwork.GlobalPos&&(this._gPosList.push(e),this._ePosList.push(e.convert2EarthPos())))},getCanvas:function(){return this._svg},updateMapPos:function(e,t,n,r){var s,o,u,a,f,l=new mapwork.Bounds;if(mapwork.supportSVG){s="M";for(o in this._gPosList)f=this._gPosList[o],u=e.width/2+t*(f.posX-n.posX)-r[0],a=e.height/2+t*(f.posY-n.posY)-r[1],l.expandToIncludePoint(u,a),o>0&&(s+=" "),s+=u+","+a;this._svg.style.left=l.getMinX()-20+"px",this._svg.style.top=l.getMinY()-20+"px",this._svg.style.width=l.getWidth()+40+"px",this._svg.style.height=l.getHeight()+40+"px",this._svg.setAttribute("viewBox",""+(l.getMinX()-20)+" "+(l.getMinY()-20)+" "+(l.getWidth()+40)+" "+(l.getHeight()+40)),s.length<=1&&(s+="0,0"),this._element.setAttribute("d",s)}else{s="";for(i=0;i<this._gPosList.length;i++)f=this._gPosList[i],u=Math.round(1*e.width/2+t*(f.posX-n.posX)-r[0]),a=Math.round(1*e.height/2+t*(f.posY-n.posY)-r[1]),i==0?s+="m "+u+","+a:i==1?s+=" l "+u+","+a:s+=","+u+","+a;this._element.path=s}}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(t){e&&e.apply(this,arguments),mapwork.supportSVG?(this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.style.zIndex=1,this._svg.style.position="absolute",this._svg.setAttribute("version","1.1"),this._svg.setAttribute("type","system"),this._svg.setAttribute("baseProfile","full"),this._svg.setAttribute("pointer-events","none"),this._htmlObj=this._svg,this._element=document.createElementNS("http://www.w3.org/2000/svg","circle"),this._element.setAttribute("stroke-width",4),this._element.setAttribute("stroke-dasharray","solid"),this._element.setAttribute("stroke-linejoin","round"),this._element.setAttribute("stroke-linecap","round"),this._element.setAttribute("stroke","#0099ff"),this._element.setAttribute("fill","red"),this._element.setAttribute("pointer-events","auto"),this._element.setAttribute("stroke-opacity",1),this._element.setAttribute("fill-opacity",1.2),this._svg.appendChild(this._element)):(this._element=document.createElement("v:oval"),this._element.style.zIndex=1,this._element.style.position="absolute",this._element.strokeWeight="4px",this._element.strokeColor="#0099ff",this._element.filled="true",this._element.fillColor="red",this._elementStroke=document.createElement("v:stroke"),this._elementStroke.endcap="round",this._element.appendChild(this._elementStroke),this._elementFill=document.createElement("v:fill"),this._elementFill.endcap="round",this._element.appendChild(this._elementFill),this._htmlObj=this._element),this._gCenterPos=null,this._eCenterPos=null,this._gEdgePos=null,this._eEdgePos=null,this._radius=0}mapwork.MapCircle=t;var e=mapwork.MapElement;t.prototype={setZIndex:function(e){mapwork.supportSVG?this._svg.style.zIndex=e:this._element.style.zIndex=e},setDash:function(e){mapwork.supportSVG?this._element.setAttribute("stroke-dasharray",e):this._elementStroke.dashstyle="ShortDash"},setWidth:function(e){mapwork.supportSVG?this._element.setAttribute("stroke-width",e):this._element.strokeWeight=e+"px"},setStrokeOpacity:function(e){mapwork.supportSVG?this._element.setAttribute("stroke-opacity",e):this._elementStroke.opacity=e},setFillOpacity:function(e){mapwork.supportSVG?this._element.setAttribute("fill-opacity",e):this._elementFill.opacity=e},setFillColor:function(e){mapwork.supportSVG?this._element.setAttribute("fill",e):this._element.fill=e},setColor:function(e){mapwork.supportSVG?this._element.setAttribute("stroke",e):this._element.strokeColor=e},setSVGAttr:function(e,t){this._svg.setAttribute(e,t)},setSVGElementAttr:function(e,t){this._element.setAttribute(e,t)},setCenterPos:function(e){e?e instanceof mapwork.EarthPos?(this._eCenterPos=e,this._gCenterPos=e.convert2GlobalPos()):e instanceof mapwork.GlobalPos&&(this._gCenterPos=e,this._eCenterPos=e.convert2EarthPos()):(this._eCenterPos=null,this._gCenterPos=null)},getECenterPos:function(){return this._eCenterPos},setEdgePos:function(e){e?e instanceof mapwork.EarthPos?(this._eEdgePos=e,this._gEdgePos=e.convert2GlobalPos()):e instanceof mapwork.GlobalPos&&(this._gEdgePos=e,this._eEdgePos=e.convert2EarthPos()):(this._eEdgePos=null,this._gEdgePos=null)},getEEdgePos:function(){return this._eEdgePos},setRadius:function(e){this._gEdgePos=null
,this._eEdgePos=null,this._radius=e},getRadius:function(){return this._radius},clearPos:function(){this._gCenterPos=null,this._eCenterPos=null,this._gEdgePos=null,this._eEdgePos=null},getCanvas:function(){return this._svg},updateMapPos:function(e,t,n,r){var i,s,o,u,a;if(!this._gEdgePos){var f=mapwork.MapRulerBuilder.getOffsetLon4RangeLength(this._eCenterPos,this._radius);f&&(this._eEdgePos=new mapwork.EarthPos(this._eCenterPos.getILat(),this._eCenterPos.getILon()+f,!0),this._gEdgePos=this._eEdgePos.convert2GlobalPos())}if(!this._gEdgePos)return;var l=new mapwork.Bounds;i=e.width/2+t*(this._gCenterPos.posX-n.posX)-r[0],s=e.height/2+t*(this._gCenterPos.posY-n.posY)-r[1],o=e.width/2+t*(this._gEdgePos.posX-n.posX)-r[0],u=e.height/2+t*(this._gEdgePos.posY-n.posY)-r[1],a=Math.sqrt((i-o)*(i-o)+(s-u)*(s-u)),mapwork.supportSVG?(l.expandToIncludePoint(i-a,s-a),l.expandToIncludePoint(i+a,s+a),this._element.setAttribute("cx",i),this._element.setAttribute("cy",s),this._element.setAttribute("r",a),this._svg.style.left=l.getMinX()-20+"px",this._svg.style.top=l.getMinY()-20+"px",this._svg.style.width=l.getWidth()+40+"px",this._svg.style.height=l.getHeight()+40+"px",this._svg.setAttribute("viewBox",""+(l.getMinX()-20)+" "+(l.getMinY()-20)+" "+(l.getWidth()+40)+" "+(l.getHeight()+40))):(this._element.style.left=i-a+"px",this._element.style.top=s-a+"px",this._element.style.width=a*2+"px",this._element.style.height=a*2+"px")}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),mapwork.supportSVG?(this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.style.zIndex=1,this._svg.style.position="absolute",this._svg.setAttribute("version","1.1"),this._svg.setAttribute("type","system"),this._svg.setAttribute("baseProfile","full"),this._svg.setAttribute("pointer-events","none"),this._htmlObj=this._svg,this._element=document.createElementNS("http://www.w3.org/2000/svg","circle"),this._element.setAttribute("stroke-width",4),this._element.setAttribute("stroke-dasharray","solid"),this._element.setAttribute("stroke-linejoin","round"),this._element.setAttribute("stroke-linecap","round"),this._element.setAttribute("stroke","#0099ff"),this._element.setAttribute("fill","red"),this._element.setAttribute("pointer-events","auto"),this._element.setAttribute("stroke-opacity",1),this._element.setAttribute("fill-opacity",1.2),this._svg.appendChild(this._element)):(this._element=document.createElement("v:oval"),this._element.style.zIndex=1,this._element.style.position="absolute",this._element.strokeWeight="4px",this._element.strokeColor="#0099ff",this._element.filled="true",this._element.fillColor="red",this._elementStroke=document.createElement("v:stroke"),this._elementStroke.endcap="round",this._element.appendChild(this._elementStroke),this._elementFill=document.createElement("v:fill"),this._elementFill.endcap="round",this._element.appendChild(this._elementFill),this._htmlObj=this._element);var t=this;mapwork.utils.bindEvent(this._element,"mousedown",function(e){t.onMouseDown(e)})}mapwork.MapSearchCircle=t;var e=mapwork.MapCircle;t.prototype={updateMapPos:function(e,t,n,r){var i,s,o,u,a;if(!this._gEdgePos){var f=mapwork.MapRulerBuilder.getOffsetLon4RangeLength(this._eCenterPos,this._radius);f&&(this._eEdgePos=new mapwork.EarthPos(this._eCenterPos.getILat(),this._eCenterPos.getILon()+f,!0),this._gEdgePos=this._eEdgePos.convert2GlobalPos())}if(!this._gEdgePos)return;var l=new mapwork.Bounds;i=e.width/2+t*(this._gCenterPos.posX-n.posX)-r[0],s=e.height/2+t*(this._gCenterPos.posY-n.posY)-r[1],o=e.width/2+t*(this._gEdgePos.posX-n.posX)-r[0],u=e.height/2+t*(this._gEdgePos.posY-n.posY)-r[1],a=Math.sqrt((i-o)*(i-o)+(s-u)*(s-u)),mapwork.supportSVG?(l.expandToIncludePoint(i-a,s-a),l.expandToIncludePoint(i+a,s+a),this._element.setAttribute("cx",i),this._element.setAttribute("cy",s),this._element.setAttribute("r",a),this._svg.style.left=l.getMinX()-20+"px",this._svg.style.top=l.getMinY()-20+"px",this._svg.style.width=l.getWidth()+40+"px",this._svg.style.height=l.getHeight()+40+"px",this._svg.setAttribute("viewBox",""+(l.getMinX()-20)+" "+(l.getMinY()-20)+" "+(l.getWidth()+40)+" "+(l.getHeight()+40))):(this._element.style.left=i-a+"px",this._element.style.top=s-a+"px",this._element.style.width=a*2+"px",this._element.style.height=a*2+"px")},onMouseDown:function(e){var t=this._layer.getMap();t.setMode(2);if(e.stopPropagation){e.stopPropagation(),e.preventDefault();if(e.button!=0)return}else{e.cancelBubble=!0,e.returnValue=!1;if(e.button!=1)return}var n=this,r=mapwork.utils.getPageX(e),i=mapwork.utils.getPageY(e),s=n._gCenterPos.posX,o=n._gCenterPos.posY,u=t.getMapLocation().getEdgeLen(),a=function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1);var t=mapwork.utils.getPageX(e),a=mapwork.utils.getPageY(e),f=s+(t-r)/u,l=o+(a-i)/u;n.setCenterPos(new mapwork.GlobalPos(f,l)),n.setEdgePos(null),n._layer.resetElement(n)},f=function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1),mapwork.utils.unbindEvent(document,"mousemove",a),mapwork.utils.unbindEvent(document,"mouseup",f),t.setMode(0)};mapwork.utils.bindEvent(document,"mousemove",a),mapwork.utils.bindEvent(document,"mouseup",f)}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(t,n,r,i,s){e&&e.apply(this,arguments),this._measureLine=s}mapwork.MeasureLabel=t;var e=mapwork.MapLabel;t.prototype={setFirst:function(){this.setName("起点"),this._div.style.color="#0A0"},setLast:function(){this.setName("总长:"+this.getName()),this._div.style.color="#f00";var e=document.createElement("img");e.style.cursor="pointer",e.style.width="10px",e.style.height="10px",e.style.verticalAlign="top",e.style.marginLeft="3px",e.style.marginTop="2px",e.src="images/measuredelete.png",e.title="删除此线",this._contentDiv.appendChild(e);var t=this;e.onclick=function(){t._measureLine.doRemove.call(t._measureLine)}}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(n){e&&e.apply(this,arguments),this._map=n,this._id="Measure"+t.INDEX++,this._iconLayer=this._map.getLayer(mapwork.MapIconLayer.ID),this._labelLayer=this._map.getLayer(mapwork.MapLabelLayer.ID),this._vectorLayer=this._map.getLayer(mapwork.MapVectorLayer.ID),this.setWidth(3),this.setOpacity(.5),this.setColor("#f00"),this._vectorLayer.addElement(this),this._mapIconStore={},this._mapLabelStore={},this._length=0}mapwork.MeasureLine=t,t.INDEX=0;var e=mapwork.MapPath;t.prototype={createIconId:function(){return this._id+"_I"+this.getPosCount()},createLabelId:function(){return this._id+"_L"+this.getPosCount()},addPos:function(e){e instanceof mapwork.EarthPos?(this._ePosList.push(e),this._gPosList.push(e.convert2GlobalPos())):e instanceof mapwork.GlobalPos&&(this._gPosList.push(e),this._ePosList.push(e.convert2EarthPos())),this._vectorLayer.resetElement(this)},clearPosList:function(){this._ePosList=[],this._gPosList=[],this._vectorLayer.resetElement(this)},removeLastPos:function(){var e=this.getPosCount();if(e>0){var t=this.createIconId(),n=this._mapIconStore[t];this._iconLayer.removeElement(n),delete this._mapIconStore[t];var r=this.createLabelId(),i=this._mapLabelStore[r];this._labelLayer.removeElement(i),delete this._mapLabelStore[r],this._ePosList.pop(),this._gPosList.pop()}},changeLastPos:function(e){this._ePosList.length>0&&(this._ePosList.pop(),this._gPosList.pop(),e instanceof mapwork.EarthPos?(this._ePosList.push(e),this._gPosList.push(e.convert2GlobalPos())):e instanceof mapwork.GlobalPos&&(this._gPosList.push(e),this._ePosList.push(e.convert2EarthPos()))),this._vectorLayer.resetElement(this)},addMeasurePos:function(e,t){this.addPos(e);var n=this.getPosCount();if(n>1){var r=this._ePosList[n-2],i=this._ePosList[n-1];this._length+=mapwork.gisUtils.getMeterLength(r,i)}var s=this.createIconId(),o=new mapwork.MapIcon(s,"images/measurepoint.png",null,[5.5,5.5]);this._mapIconStore[s]=o,o.setPos(e),this._iconLayer.addElement(o),this._iconLayer.resetElement(o),s=this.createLabelId();var u=mapwork.gisUtils.getDisplayLength(this._length),a=new mapwork.MeasureLabel(s,u,e,[10,-10],this);n==1&&a.setFirst(),this._mapLabelStore[s]=a,this._labelLayer.addElement(a),this._labelLayer.resetElement(a)},changeLastMeasurePos:function(e){this.changeLastPos(e)},doStop:function(){if(this._length<=0)this.doRemove();else{var e=this.createLabelId(),t=this._mapLabelStore[e];t&&t.setLast()}},doRemove:function(){this._vectorLayer.removeElement(this);for(var e in this._mapIconStore)this._mapIconStore[e].doRemove();this._mapIconStore={};for(e in this._mapLabelStore)this._mapLabelStore[e].doRemove();this._mapLabelStore={}}},e&&mapwork.utils.inherits(t,e)}(),function(){function n(t){e&&e.apply(this,arguments),t?this._layerId=t:this._layerId=n.ID,typeof this._layerId=="string"&&(this._div.className=this._layerId),this._div.style.zIndex=0,this._urlPath=mapwork.configs[this._layerId+"_url"]+"&dataset="+mapwork.mapStyle,this._grid=[]}function r(e,n,r,i,s){var o=e._grid,u,a,f,l,c=Math.floor((n.posX*i-s.width/2)/256),h=Math.floor((n.posX*i+s.width/2)/256),p=o[0];if(!p)return;var d=p[0];while(c<d._tileX){a=d._tileX-1;for(f=0;f<o.length;f++){l=o[f],u=l.pop(),u.destroy(),u=t.getImageTile();var v=l[0]._left-256,m=l[0]._top;u.addToLayer(e,a,l[0]._tileY,r,v,m),u.draw(),l.unshift(u)}d=p[0]}var g=p[p.length-1];while(h>g._tileX){a=g._tileX+1;for(f=0;f<o.length;f++)l=o[f],u=l.shift(),u.destroy(),u=t.getImageTile(),v=l[l.length-1]._left+256,m=l[l.length-1]._top,u.addToLayer(e,l[l.length-1]._tileX+1,l[l.length-1]._tileY,r,v,m),u.draw(),l.push(u);g=p[p.length-1]}}function i(e,n,r,i,s){var o,u,a,f,l,c=e._grid,h=Math.floor((n.posY*i-s.height/2)/256),p=Math.floor((n.posY*i+s.height/2)/256),d=c[0];while(h<d[0]._tileY){o=c.pop(),c.unshift(o);var v=o.length;for(a=0;a<v;a++)o[a].destroy(),u=t.getImageTile(),f=d[a]._left,l=d[a]._top-256,u.addToLayer(e,d[a]._tileX,d[a]._tileY-1,r,f,l),u.draw(),o[a]=u;d=c[0]}var m=c[c.length-1];while(p>m[0]._tileY){o=c.shift(),c.push(o);for(a=0;a<o.length;a++)o[a].destroy(),u=t.getImageTile(),f=m[a]._left,l=m[a]._top+256,u.addToLayer(e,m[a]._tileX,m[a]._tileY+1,r,f,l),u.draw(),o[a]=u;m=c[c.length-1]}}mapwork.TileLayer=n,n.ID="tileLayer";var e=mapwork.Layer,t=mapwork.TileStore;n.prototype={setMap:function(e){this._map=e,this._mapLocation=this._map.getMapLocation()},getMapZoom:function(){return this._mapLocation.getZoom()},getMapCenterGlobalPos:function(){return this._mapLocation.getMapCenterGlobalPos()},getEdgeNum:function(){return this._mapLocation.getEdgeNum()},getEdgeLen:function(){return this._mapLocation.getEdgeLen()},getSize:function(){return this._map.getSize()},initLayer:function(){this.resetLayer()},resetLayer:function(){var e,n;while(this._grid.length>0){e=this._grid.pop();while(e.length>0)n=e.pop(),n&&n.destroy()}var r=this.getMapZoom(),i=this.getMapCenterGlobalPos(),s=this.getEdgeNum(),o=this.getEdgeLen(),u=this.getSize(),a=this._map._layerContainer.getLayerOffsetPos(),f=s*i.posX+a[0]/256,l=s*i.posY+a[1]/256,c=Math.floor(f),h=Math.floor(l),p=u.width/2+.05,d=u.height/2+.05,v=Math.floor((i.posX*o-u.width/2)/256),m=Math.floor((i.posY*o-u.height/2)/256),g=Math.ceil((i.posX*o+u.width/2)/256),y=Math.ceil((i.posY*o+u.height/2)/256),b=parseInt((f-c)*256),w=parseInt((l-h)*256),E=p-b,S=d-w;this._rows=y-m+1,this._cols=g-v+1;for(var x=0;x<this._rows;x++){e=[],this._grid.push(e);for(var T=0;T<this._cols;T++){n=t.getImageTile(),e.push(n);var N=E+256*(T+v-c),C=S+256*(x+m-h);n.addToLayer(this,T+v,x+m,r,N,C),n.draw()}}},draggedLayer:function(e){var t=this.getMapZoom(),n=null;e?n=e:n=this.getMapCenterGlobalPos();var s=this.getEdgeLen(),o=this.getSize();if(o.width<=0||o.height<=0)return;r(this,n,t,s,o),i(this,n,t,s,o)},resizeLayer:function(){var e,n,r,i,s,o,u,a=this.getMapZoom(),f=this.getMapCenterGlobalPos(),l=this.getEdgeLen(),c=this.getSize();if(c.width<=0||c.height<=0)return;var h=Math.floor((f.posX*l-c.width/2)/256),p=Math.floor((f.posY*l-c.height/2)/256),d=Math.ceil((f.posX*l+c.width/2)/256),v=Math.ceil((f.posY*l+c.height/2)/256);this._rows=v-p+1,this._cols=d-h+1;var m=this._grid,g=m[0];while(p<g[0]._tileY){u=[],m.unshift(u);var y=g.length;for(e=0;e<y;e++)n=t.getImageTile(),r=g[e]._left,i=g[e]._top-256,n.addToLayer(this,g[e]._tileX,g[e]._tileY-1,a,r,i),n.draw(),u.push(n);g=m[0]}var b=m[m.length-1];while(v>b[0]._tileY){u=[],m.push(u),y=b.length;for(e=0;e<y;e++)n=t.getImageTile(),r=b[e]._left,i=b[e]._top+256,n.addToLayer(this,b[e]._tileX,b[e]._tileY+1,a,r,i),n.draw(),u.push(n);b=m[m.length-1]}u=m[0];while(h<u[0]._tileX){s=u[0]._tileX-1;for(e=0;e<m.length;e++)o=m[e],n=t.getImageTile(),r=o[0]._left-256,i=o[0]._top,n.addToLayer(this,s,o[0]._tileY,a,r,i),n.draw(),o.unshift(n)}while(d>u[u.length-1]._tileX){s=u[u.length-1]._tileX+1;for(e=0;e<m.length;e++)o=m[e],n=t.getImageTile(),r=o[o.length-1]._left+256,i=o[o.length-1]._top,n.addToLayer(this,o[o.length-1]._tileX+1,o[o.length-1]._tileY,a,r,i),n.draw(),o.push(n)}},changedLayerZoom:function(){this.resetLayer()},changeUrl:function(e){e?this._urlPath=mapwork.configs[this._layerId+"_url"]+"&dataset="+e:this._urlPath=mapwork.configs[this._layerId+"_url"]+"&dataset="+mapwork.mapStyle;for(var t in this._grid){var n=this._grid[t];for(var r in n)n[r].draw()}},setUrlPath:function(e){if(!e)return;if(this._urlPath==e)return;this._urlPath=e,this.changeUrl()},getUrlPath:function(){return this._urlPath},makeTileUrl:function(e,t,n){return this._urlPath?this._urlPath+"&x="+e+"&y="+t+"&zoom="+n:null}},e&&mapwork.utils.inherits(n,e)}(),function(){function n(t){e&&e.apply(this,arguments),t?this._layerId=t:this._layerId=n.ID,typeof this._layerId=="string"&&(this._div.className=this._layerId),this._div.style.zIndex=0,this._urlPath=mapwork.configs[this._layerId+"_url"]+"&dataset="+mapwork.mapStyleT,this._grid=[]}function r(e,n,r,i,s){var o=e._grid,u,a,f,l,c=Math.floor((n.posX*i-s.width/2)/256),h=Math.floor((n.posX*i+s.width/2)/256),p=o[0];if(!p)return;var d=p[0];while(c<d._tileX){a=d._tileX-1;for(f=0;f<o.length;f++){l=o[f],u=l.pop(),u.destroy(),u=t.getImageTile();var v=l[0]._left-256,m=l[0]._top;u.addToLayer(e,a,l[0]._tileY,r,v,m),u.draw(),l.unshift(u)}d=p[0]}var g=p[p.length-1];while(h>g._tileX){a=g._tileX+1;for(f=0;f<o.length;f++)l=o[f],u=l.shift(),u.destroy(),u=t.getImageTile(),v=l[l.length-1]._left+256,m=l[l.length-1]._top,u.addToLayer(e,l[l.length-1]._tileX+1,l[l.length-1]._tileY,r,v,m),u.draw(),l.push(u);g=p[p.length-1]}}function i(e,n,r,i,s){var o,u,a,f,l,c=e._grid,h=Math.floor((n.posY*i-s.height/2)/256),p=Math.floor((n.posY*i+s.height/2)/256),d=c[0];while(h<d[0]._tileY){o=c.pop(),c.unshift(o);var v=o.length;for(a=0;a<v;a++)o[a].destroy(),u=t.getImageTile(),f=d[a]._left,l=d[a]._top-256,u.addToLayer(e,d[a]._tileX,d[a]._tileY-1,r,f,l),u.draw(),o[a]=u;d=c[0]}var m=c[c.length-1];while(p>m[0]._tileY){o=c.shift(),c.push(o);for(a=0;a<o.length;a++)o[a].destroy(),u=t.getImageTile(),f=m[a]._left,l=m[a]._top+256,u.addToLayer(e,m[a]._tileX,m[a]._tileY+1,r,f,l),u.draw(),o[a]=u;m=c[c.length-1]}}mapwork.TrafficTileLayer=n,n.ID="trafficTileLayer";var e=mapwork.Layer,t=mapwork.TileStore;n.prototype={setMap:function(e){this._map=e,this._mapLocation=this._map.getMapLocation()},getMapZoom:function(){return this._mapLocation.getZoom()},getMapCenterGlobalPos:function(){return this._mapLocation.getMapCenterGlobalPos()},getEdgeNum:function(){return this._mapLocation.getEdgeNum()},getEdgeLen:function(){return this._mapLocation.getEdgeLen()},getSize:function(){return this._map.getSize()},initLayer:function(){this.resetLayer()},resetLayer:function(){var e,n;while(this._grid.length>0){e=this._grid.pop();while(e.length>0)n=e.pop(),n&&n.destroy()}var r=this.getMapZoom(),i=this.getMapCenterGlobalPos(),s=this.getEdgeNum(),o=this.getEdgeLen(),u=this.getSize(),a=this._map._layerContainer.getLayerOffsetPos(),f=s*i.posX+a[0]/256,l=s*i.posY+a[1]/256,c=Math.floor(f),h=Math.floor(l),p=u.width/2+.05,d=u.height/2+.05,v=Math.floor((i.posX*o-u.width/2)/256),m=Math.floor((i.posY*o-u.height/2)/256),g=Math.ceil((i.posX*o+u.width/2)/256),y=Math.ceil((i.posY*o+u.height/2)/256),b=parseInt((f-c)*256),w=parseInt((l-h)*256),E=p-b,S=d-w;this._rows=y-m+1,this._cols=g-v+1;for(var x=0;x<this._rows;x++){e=[],this._grid.push(e);for(var T=0;T<this._cols;T++){n=t.getImageTile(),e.push(n);var N=E+256*(T+v-c),C=S+256*(x+m-h);n.addToLayer(this,T+v,x+m,r,N,C),n.draw()}}},draggedLayer:function(e){var t=this.getMapZoom(),n=null;e?n=e:n=this.getMapCenterGlobalPos();var s=this.getEdgeLen(),o=this.getSize();if(o.width<=0||o.height<=0)return;r(this,n,t,s,o),i(this,n,t,s,o)},resizeLayer:function(){var e,n,r,i,s,o,u,a=this.getMapZoom(),f=this.getMapCenterGlobalPos(),l=this.getEdgeLen(),c=this.getSize();if(c.width<=0||c.height<=0)return;var h=Math.floor((f.posX*l-c.width/2)/256),p=Math.floor((f.posY*l-c.height/2)/256),d=Math.ceil((f.posX*l+c.width/2)/256),v=Math.ceil((f.posY*l+c.height/2)/256);this._rows=v-p+1,this._cols=d-h+1;var m=this._grid,g=m[0];while(p<g[0]._tileY){u=[],m.unshift(u);var y=g.length;for(e=0;e<y;e++)n=t.getImageTile(),r=g[e]._left,i=g[e]._top-256,n.addToLayer(this,g[e]._tileX,g[e]._tileY-1,a,r,i),n.draw(),u.push(n);g=m[0]}var b=m[m.length-1];while(v>b[0]._tileY){u=[],m.push(u),y=b.length;for(e=0;e<y;e++)n=t.getImageTile(),r=b[e]._left,i=b[e]._top+256,n.addToLayer(this,b[e]._tileX,b[e]._tileY+1,a,r,i),n.draw(),u.push(n);b=m[m.length-1]}u=m[0];while(h<u[0]._tileX){s=u[0]._tileX-1;for(e=0;e<m.length;e++)o=m[e],n=t.getImageTile(),r=o[0]._left-256,i=o[0]._top,n.addToLayer(this,s,o[0]._tileY,a,r,i),n.draw(),o.unshift(n)}while(d>u[u.length-1]._tileX){s=u[u.length-1]._tileX+1;for(e=0;e<m.length;e++)o=m[e],n=t.getImageTile(),r=o[o.length-1]._left+256,i=o[o.length-1]._top,n.addToLayer(this,o[o.length-1]._tileX+1,o[o.length-1]._tileY,a,r,i),n.draw(),o.push(n)}},changedLayerZoom:function(){this.resetLayer()},changeUrl:function(){this._urlPath=mapwork.configs[this._layerId+"_url"]+"&dataset="+mapwork.mapStyle;for(var e in this._grid){var t=this._grid[e];for(var n in t)t[n].draw()}},setUrlPath:function(e){if(!e)return;if(this._urlPath==e)return;this._urlPath=e,this.changeUrl()},getUrlPath:function(){return this._urlPath},makeTileUrl:function(e,t,n){return this._urlPath?this._urlPath+"&x="+e+"&y="+t+"&zoom="+n+"&t="+(new Date).getTime():null},refreshPage:function(){for(var e in this._grid){var t=this._grid[e];for(var n in t)t[n]._image.style.display="none",t[n].draw()}}},e&&mapwork.utils.inherits(n,e)}(),function(){function t(){e&&e.apply(this,arguments),this._elementStore={}}mapwork.MapElementLayer=t;var e=mapwork.Layer;t.prototype={addElement:function(e){e&&e.getHtmlObj()&&(this._elementStore[e.getElementId()]=e,this._div.appendChild(e.getHtmlObj()),e.setLayer(this))},removeElement:function(e){e&&(this._div.removeChild(e.getHtmlObj()),delete this._elementStore[e.getElementId()],e.setLayer(null))},resetElement:function(e){if(e){var t=this._map.getMapLocation(),n=t.getMapCenterGlobalPos(),r=t.getEdgeLen(),i=this._map.getSize(),s=this._layerContainer.getLayerOffsetPos(),o=t.getZoom();e.updateMapPos(i,r,n,s),e.updateMapZoom(o)}},resetLayer:function(){var e=this._map.getMapLocation(),t=e.getMapCenterGlobalPos(),n=e.getEdgeLen(),r=this._map.getSize(),i=this._layerContainer.getLayerOffsetPos(),s=e.getZoom();for(var o in this._elementStore){var u=this._elementStore[o];u.updateMapPos(r,n,t,i),u.updateMapZoom(s)}},initLayer:function(){this.resetLayer()},changedLayerZoom:function(){this.resetLayer()}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._layerId=t.ID,typeof this._layerId=="string"&&(this._div.className=this._layerId),this._div.style.zIndex=200}mapwork.MapVectorLayer=t,t.ID="MapVectorLayer";var e=mapwork.MapElementLayer;t.prototype={doTest:function(){var e="Path"+(new Date).getTime(),t=new mapwork.MapPath(e);t.addPos(new mapwork.EarthPos(31.241696,121.491722)),t.addPos(new mapwork.EarthPos(31.245733,121.499576)),t.addPos(new mapwork.EarthPos(31.242907,121.525453)),this.addElement(t);var n=new mapwork.MapCircle("circle1");n.setCenterPos(new mapwork.EarthPos(31.230248,121.450051)),n.setEdgePos(new mapwork.EarthPos(31.235496,121.457389)),n.setStrokeOpacity(.5),n.setFillOpacity(.2),this.addElement(n),n=new mapwork.MapCircle("circle2"),n.setCenterPos(new mapwork.EarthPos(31.2503813,121.4802679)),n.setRadius(1e3),n.setStrokeOpacity(.8),n.setFillOpacity(.6),this.addElement(n),this.initLayer()}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._layerId=t.ID,typeof this._layerId=="string"&&(this._div.className=this._layerId),this._div.style.zIndex=300}mapwork.MapShadowLayer=t,t.ID="MapShadowLayer";var e=mapwork.MapElementLayer;t.prototype={},e&&mapwork.utils.inherits(t,e)}(),function(){function t(n){e&&e.apply(this,arguments),n?this._layerId=n:this._layerId=t.ID,typeof this._layerId=="string"&&(this._div.className=this._layerId),this._div.style.zIndex=400}mapwork.MapIconLayer=t,t.ID="MapIconLayer";var e=mapwork.MapElementLayer;t.prototype={empty:function(){$(this._div).empty()}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._layerId=t.ID,typeof this._layerId=="string"&&(this._div.className=this._layerId),this._div.style.zIndex=500}mapwork.MapLabelLayer=t,t.ID="MapLabelLayer";var e=mapwork.MapElementLayer;t.prototype={},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._layerId=t.ID,typeof this._layerId=="string"&&(this._div.className=this._layerId),this._div.style.zIndex=600}mapwork.MapPopLayer=t,t.ID="MapPopLayer";var e=mapwork.MapElementLayer;t.prototype={},e&&mapwork.utils.inherits(t,e)}(),function(){function t(){e&&e.apply(this,arguments),this._layerId=t.ID,typeof this._layerId=="string"&&(this._div.className=this._layerId),this._div.style.zIndex=800}mapwork.MapTipLayer=t,t.ID="MapTipLayer";var e=mapwork.MapElementLayer;t.prototype={},e&&mapwork.utils.inherits(t,e)}(),function(){function n(n,r){t&&t.apply(this,arguments),this._div=document.createElement("div"),this._controlsDiv=document.createElement("div"),this._controlsDiv.style.zIndex=1e4,this._div.className="mapcontainer",e.extend(this,r),this._div.style.width="100%",this._div.style.height="100%",this._div.style.position="relative",this._div.style.cursor="default",this._div.style.overflow="hidden",n&&(typeof n=="string"?(n=document.getElementById(n),n&&n.appendChild(this._div)):n.appendChild(this._div)),this._mapPos={x:0,y:0},this._size={width:0,height:0},this._modules={},this._mapLocation=new mapwork.MapLocation(this,this.lat,this.lon,this.zoom),this._controls={},this._layerContainer=new mapwork.LayerContainer(this),this._div.appendChild(this._layerContainer._div),this._div.appendChild(this._controlsDiv),this._handlers={},this._mode=0,this._menu=new mapwork.Menu(this);var i=this._layerContainer.getLayer(mapwork.MapTipLayer.ID);i&&(this._tip=new mapwork.MapTip(this),i.addElement(this._tip))}mapwork.Map=n;var e=mapwork.utils,t=null;n.prototype={setMode:function(e){this._mode=e},getMode:function(){return this._mode},destroy:function(){if(this._controls){for(var e=this._controls.length;e>=0;e--)this._controls[e].destroy();this._controls=null}},resetSize:function(e){e?(this._size.width=e.width,this._size.height=e.height):(this._size.width=this._div.clientWidth,this._size.height=this._div.clientHeight),this.fireEvent(mapwork.MapEvent.RESIZE,this)},addLayer:function(e){this._layerContainer.addLayer(e)},getLayerContainer:function(){return this._layerContainer},getLayer:function(e){return this._layerContainer.getLayer(e)},removeLayer:function(e){this._layerContainer.removeLayer(e)},addControl:function(e){if(e instanceof mapwork.Control){var t=e.getControlId();t&&(this._controls[t]=e,e.setMap(this),e.appendToDiv(this._controlsDiv))}},getControl:function(e){return this._controls[e]},addHandler:function(e){if(e instanceof mapwork.Handler){var t=e.getHandlerId();t&&(this._handlers[t]=e,e.setMap(this))}},getHandler:function(e){return this._handlers[e]},getSize:function(){return this._size},getMapPos:function(){return this._mapPos},getMenu:function(){return this._menu},getMapLocation:function(){return this._mapLocation},addEventListener:function(t,n,r,i){t.startsWith("mapwork.")?this.addListener(t,function(){n.call(r,i)}):e.bindEvent(this._div,t,function(e){n.call(r,e,i)})},openTip:function(e,t,n,r,i,s){this._tip&&this._tip.open(e,t,n,r,i,s)},hideTip:function(){this._tip&&this._tip.doHide()},isTipDisplay:function(){return this._tip?this._tip.isDisplay():!1},movedToMapCenter:function(e){this._layerContainer.movedToMapCenter(e)},movingToMapCenter:function(e){this._layerContainer.movingToMapCenter(e)},zoomToMapCenter:function(e,t){this._mapLocation.getZoom()===t?this._layerContainer.movedToMapCenter(e):this._mapLocation._zoomToMapCenter(e,t)},slidingToMapCenter:function(e,t,n){function h(){l.movedMap(a,f),c++,c>=n&&p&&(clearInterval(p),p=null,t&&t.call())}var r;if(e instanceof mapwork.GlobalPos)r=e;else{if(!(e instanceof mapwork.EarthPos))return;r=e.convert2GlobalPos()}var i=this._mapLocation.getEdgeLen(),s=this._mapLocation.getMapCenterGlobalPos(),o=(s.posX-r.posX)*i,u=(s.posY-r.posY)*i;n||(n=50);var a=o/n,f=u/n,l=this._layerContainer,c=0,p=setInterval(h,1)},fitBounds:function(e){if(e.isNull())return;var t=this._size.width,n=this._size.height;if(t>0&&n>0){var r=(e.getMinX()+e.getMaxX())/2,i=(e.getMinY()+e.getMaxY())/2,s=t/e.getWidth(),o=n/e.getHeight(),u=s;o<u&&(u=o);var a=mapwork.utils.getFitZoom(u);this.zoomToMapCenter(new mapwork.GlobalPos(r,i),a)}},addModule:function(e){if(e instanceof mapwork.Module){var t=e.getModuleId();t&&(this._modules[t]=e,e.setMap(this))}},getModule:function(e){var t=this._modules[e];return t?t:this._modules[mapwork.UserItem.ID]},openModule:function(e){if(!this._modules[e])return;var t=this._modules[e];t.init(),t.doListQuery(),t.doPageQuery(),this._currentModule=t}},t&&mapwork.utils.inherits(n,t),mapwork.utils.extend(n.prototype,mapwork.eventBase)}(),function(){function t(t,n){e&&e.apply(this,arguments),this._groupName=t,this._groupIndex=n,this._menuArray=[]}mapwork.MenuGroup=t;var e=null;t.prototype={addMenuItem:function(e,t){this._menuArray.push({name:e,listener:t})},getMenuItemCount:function(){return this._menuArray.length},getMenuArray:function(){return this._menuArray},compareTo:function(e){return this._groupIndex-e._groupIndex}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(t){e&&e.apply(this,arguments),this._map=t,this._menuGroupArray=[];var n=new mapwork.MenuGroup("zoom",20);n.addMenuItem("放大",function(){t.getMapLocation().offsetZoom(1)}),n.addMenuItem("缩小",function(){t.getMapLocation().offsetZoom(-1)}),this.addMenuGroup(n)}mapwork.Menu=t;var e=null;t.prototype={setMousePos:function(e,t){this._mousePos={posX:+e,posY:+t}},getMousePos:function(){return this._mousePos},getMenuGroupCount:function(){return this._menuGroupArray.length},addMenuGroup:function(e){e instanceof mapwork.MenuGroup&&this._menuGroupArray.push(e)},buildMenuDiv:function(e){var t,n,r,i,s;this.sortMenu();for(t in this._menuGroupArray){t>0&&(r=document.createElement("LI"),e.appendChild(r),r.className="menuLiLine"),s=this._menuGroupArray[t];var o=s.getMenuArray();if(o.length>0)for(n in o)i=o[n],r=document.createElement("LI"),r.innerHTML=i.name,e.appendChild(r),r.className="menuLiNormal",r.onclick=i.listener,r.onmouseover=function(){this.className="menuLiMouseOver"},r.onmouseout=function(){this.className="menuLiNormal"}}},sortMenu:function(){this._menuGroupArray=this._menuGroupArray.sort(function(e,t){return e.compareTo(t)})}},e&&mapwork.utils.inherits(t,e)}(),function(){function n(e,n){t&&t.apply(this,arguments),this._module=e,this._index=n,this._tipOffsetTop4Icon=5,this._tipOffsetTop4Pop=30,this._isEditable=!1}var e='<div class="lineWrap"><div></div></div><div class="tips_show"><div class="dis" id="tms1">    <div class="tips_right">		 <form name="rangeSearchForm">        <span><input type="text" id="rangeSearchName" class="text_03"></span>        <span><input type="image" src="images/btn_tips_search.gif"></span>		 </form>    </div></div></div></div>';mapwork.ModuleItem=n,n.tailDiv=e;var t=null;n.selectItem=null,n.prototype={setSidebar:function(e){this._sideBar=e;var t=this;this._sideBar._$refresh&&this._sideBar._$refresh.click(function(e){mapwork.RoleItem.selectRoleItem===t&&(t.doFocus(),t._sideBar._$Content.find(".popuplist-main").slideUp())})},setIndex:function(e){this._index=e},setZIndex:function(e){this._zIndex=e},getZIndex:function(){return this._zIndex},setId:function(e){this._id=e},getId:function(){return this._id},setName:function(e){this._name=e},getName:function(){return this._name},setDescribe:function(e){this._discribe=e},getDescribe:function(){return this._discribe},setIcon:function(e){this._icon=e},getIcon:function(){return this._icon},setHoverIcon:function(e){this._hoverIcon=e},getHoverIcon:function(){return this._hoverIcon},setOffsetPos:function(e){this._offsetPos=e},getOffsetPos:function(){return this._offsetPos},setJsonData:function(e){this._json=e},getJsonData:function(){return this._json},setMap:function(e){this._map=e},getMap:function(){return this._map},setEarthPos:function(e){this._ePos=e},getEarthPos:function(){return this._ePos},reset:function(){},getSidebarElement:function(){this._$Content=$(this.getSidebarContent()),this._$ContentImage=this._$Content.find("img");var e=this;return this._$Content.hover(function(){e.doHover()},function(){e.deHover()}),this._$Content.click(function(){}),this._$Content.find(".expand").click(function(t){t.stopPropagation?(t.stopPropagation(),t.preventDefault()):(t.cancelBubble=!0,t.returnValue=!1);var n=$(e._$Content).find(">.popuplist-main");n.toggle("slow"),$(".popuplist-main").each(function(){this!==n[0]&&$(this).slideUp()}),e.afterExpandDetail()}),this._$Content.get(0)},afterExpandDetail:function(){var e=this._$Content.find(".cardDetail")},getMapIcon:function(){if(!this._mapIcon){this._mapIcon=this.createMapIcon();if(this._mapIcon){this._mapIcon.setEarthPos(this._ePos);var e=this;$(this._mapIcon.getHtmlObj()).hover(function(t){e.doHover(),e.showHoverLabel(t)},function(t){e.deHover(),e.hideHoverLabel()}),this._mapIcon.getHtmlObj().onclick=function(t){e.doFocus()},this._mapIcon.getHtmlObj().ondblclick=function(e){e.stopPropagation?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1)}}}return this._mapIcon},getDetailUrl:function(){return this._module._setting.detailUrl},getDetailParam:function(e){return null},isNeedItemQuery:function(){return!0},doItemDetailInfo:function(){function t(t){e.onItemQueryResult(t)}var e=this;$.ajax({url:this.getDetailUrl(),async:!1,dataType:"json",cache:!1,data:this.getDetailParam(),success:t})},onItemQueryResult:function(e){mapwork.utils.extend(this._json,e)},doBeforeOpenTip:function(){},getTipTitle:function(){return this._name},getTipContent:function(){return""},getTipTail:function(){var t=$(e),n=t.find("form[name='rangeSearchForm']").get(0),r=this._map.getHandler(mapwork.RangeSearchHandler.ID);if(n){var i=this;t.find(".tips_left a").each(function(){this.onclick=function(){var e=$(this).html();r.openRangeSearchControl(i._mapIcon.getEarthPos()),r.doSearch(e)}}),n.onsubmit=function(){var e=t.find("#rangeSearchName").val();return r.openRangeSearchControl(i._mapIcon.getEarthPos()),r.doSearch(e),!1}}return t},doOpenTip:function(){this.doBeforeOpenTip(),this._index===undefined?this._map.openTip(this._ePos,this.getTipTitle(),this.getTipContent(),this.getTipTail(),this._tipOffsetTop4Icon):this._map.openTip(this._ePos,this.getTipTitle(),this.getTipContent(),this.getTipTail(),this._tipOffsetTop4Pop)},doRemove:function(){this._mapIcon.doRemove()},getSidebarContent:function(){return""},setHoverImage:function(){this._$ContentImage&&this._$ContentImage.attr("src",this._hoverIcon)},setDefaultImage:function(){this._$ContentImage&&this._$ContentImage.attr("src",this._icon)},setHoverDiv:function(){this._$Content&&this._$Content.addClass("on")},setDefaultDiv:function(){this._$Content&&this._$Content.removeClass("on")},showHoverLabel:function(e){if(this._name){var t=this._map._mapLocation.getPageX(e),n=this._map._mapLocation.getPageY(e),r=this._map._mapLocation.getEarthPosFromMapPos(t,n),i=this._map.getLayer(mapwork.MapPopLayer.ID);this._hoverLabel||(this._hoverLabel=new mapwork.MapLabel("hoverLabel"),this._hoverLabel._htmlObj.style.zIndex=101,this._hoverLabel._offsetPos=[8,8]),this._hoverLabel.setPos(r),this._hoverLabel.setName(this._name),i.addElement(this._hoverLabel),i.resetElement(this._hoverLabel)}},hideHoverLabel:function(){this._hoverLabel&&this._hoverLabel.doRemove()},doHover:function(){this.setHoverDiv(),this.setHoverImage(),this.getMapIcon().setHoverImage()},deHover:function(){this.setDefaultDiv(),this!==n.selectItem&&(this.setDefaultImage(),this.getMapIcon().setDefaultImage())},doFocus:function(){this.isNeedItemQuery
()&&this.doItemDetailInfo(),this.doOpenTip();if(this._index===undefined)this.getMapIcon().setHoverImage();else{var e=n.selectItem;e&&e!=this&&(e.setDefaultImage(),e._$Content&&e._$Content.removeClass("clicked"),e.getMapIcon().clearFocus()),n.selectItem=this,this._$Content&&this._$Content.addClass("clicked"),this.getMapIcon().doFocus(),this._$Content&&this._$Content.scrollintoview()}},createMapIcon:function(){var e=this._id,t=this._icon,n=this._hoverIcon,r=this._offsetPos,i=new mapwork.MapIcon(e,t,n,r,this._zIndex);return i}},t&&mapwork.utils.inherits(n,t)}(),function(){function t(t){e&&e.apply(this,arguments),this._module=t}mapwork.BaseSideBar=t;var e=null;t.prototype={init:function(){},resize:function(){},onPageQueryResult:function(e,t){},onListQueryResult:function(e,t){},clean:function(){},reset:function(){}},e&&mapwork.utils.inherits(t,e)}(),function(){function n(t){e&&e.apply(this,arguments)}mapwork.SideBarPage=n;var e=mapwork.BaseSideBar,t='<div class="map-tool"><div class="row">          <div class="span5">                 <div class="map-search pull-left">              <form>                 <div class="input-append">                   <input name="searchInput" class="searchInput pull-left" size="10" type="text" placeholder="搜索…" data-toggle="tooltip" data-placement="bottom" title="输入你要查找的卡ID或名称" autocomplete="off">                 </div>               </form>             </div>             </div>           </div>           </div>   <div class="public-listings stretch scroll"><ul id="listings" class="listings"><div class="result_search lists_has_weibo"></div></ul></div>';n.prototype={init:function(){$("#indexbox").hide(),this._$SideBarDiv=$("#sidebar"),this._pageQuery=this._module.doPageQuery,this._$SideBarDiv.empty(),this._$ConentDiv=$(t),this._$Right=this._$ConentDiv.find(".right"),this._$RecordCount=this._$ConentDiv.find(".search_title .padlr5"),this._$Content=this._$ConentDiv.find(".result_search"),this._$Page=this._$ConentDiv.find(".page"),this._$A=this._$ConentDiv.find("li a"),this._$searchInput=this._$ConentDiv.find(".searchInput");var e=this;this._$searchInput.keyup(function(t){t.which===13&&t.preventDefault();var n=e._module.findCards(this.value);n&&e.onPageQueryResult(n,e)}),this._$refresh=this._$ConentDiv.find("#refresh"),this._$SideBarDiv.append(this._$ConentDiv),this._$SideBarDiv.show();if(this._pageQuery){var e=this;this._$A.each(function(t){this.onclick=function(){this.pageInfo&&e._pageQuery.call(e._module,this.pageInfo.pageIndex,this.pageInfo.pageSize)}})}this.adjustSideBarHeight(),$("#btnReturn").click(function(){e.doReturn()})},adjustSideBarHeight:function(){var e=$("#w").height(),t=$(".search_title").outerHeight(),n=$(".mb_line").height(),r=this._$Page.outerHeight();this._$Content.height(e-n-t-r)},resize:function(){this.adjustSideBarHeight()},onPageQueryResult:function(e,t){this.reset(),t!==this&&this._$searchInput.val(""),this._json=e;if(e)if(!e.m_detail){this._$Right.show(),this._$RecordCount.html(e.total);for(var n in e)this._$Content.prepend(e[n].getSidebarElement())}else this._$Right.hide(),this._$Content.html('<td colspan="5" style="text-align:center;">'+e.m_message+"</td>");else this._$Right.hide(),this._$Content.html('<td colspan="5" style="text-align:center;">无相关信息</td>')},clean:function(){this._$SideBarDiv.empty();for(var e=0;e<=5;e++)e>=1&&e<5&&(this._$A.eq(e).html(""),this._$A.eq(e).removeClass("selected")),this._$A.get(e).pageInfo=null,this._$A.get(e).onclick=null},reset:function(){if(this._json)for(var e in this._json)this._json[e].reset();this._$Content.empty(),this._$RecordCount.empty()},doReturn:function(){$("div[name='indexDiv']").show(),this._$SideBarDiv.hide(),this._module.clean()}},e&&mapwork.utils.inherits(n,e)}(),function(){function t(t){e&&e.apply(this,arguments),this._setting=t,this._isPageFitBounds=!0}mapwork.Module=t;var e=null;t.prototype={init:function(){this._sideBar=this.buildSideBar(),this._sideBar.init()},getModuleId:function(){return this._setting.ID},setMap:function(e){this._map=e},buildSideBar:function(){return this._setting.newSidebar?this._setting.newSidebar(this):new mapwork.SideBarPage(this)},buildModuleItem:function(e,t){var n=this._setting.newModuleItem(this,t);return n.setJsonData(e),n.setSidebar(this._sideBar),n},doPageQueryTest:function(){this._sideBar.reset();if(this._objectArray)for(var e in this._objectArray)this._objectArray[e].doRemove();this._map.hideTip();var t=this.getTestPageResult();this.onPageQueryResult(t)},doListQueryTest:function(){var e=this.getTestListResult();this.onListQueryResult(e)},clean:function(){this._sideBar.clean(),this.doRemoveIconList(),this.doHideTip();var e=this._map.getLayer("moduleListLayer");e&&e.empty(),this._setting.clean&&this._setting.clean(this)},workAllPageItem:function(e){if(this._pageQueryResult&&this._pageQueryResult.group)for(var t in this._pageQueryResult.group){var n=this._pageQueryResult.group[t];n._moduleItem&&e.call(n._moduleItem,n._moduleItem)}},workAllListItem:function(e){if(this._listQueryResult&&this._listQueryResult.group)for(var t in this._listQueryResult.group){var n=this._listQueryResult.group[t];n._moduleItem&&e.call(n._moduleItem,n._moduleItem)}},doRemoveIconList:function(){if(this._pageQueryResult&&this._pageQueryResult.group)for(var e in this._pageQueryResult.group){var t=this._pageQueryResult.group[e];t._moduleItem&&t._moduleItem.doRemove()}},doHideTip:function(){this._map.hideTip()},doPageQuery:function(e,t){this._sideBar.reset(),this.workAllPageItem(function(e){e.doRemove()}),this.doHideTip();var n={};n["pagination.pageIndex"]=e,n["pagination.pageSize"]=t;var r=this._setting.pageUrl;this._ajaxFlag=(new Date).getTime();var i=this;r&&r.length>0&&$.ajax({url:r,data:n,dataType:"json",cache:!1,success:function(e){return function(t){e===i._ajaxFlag&&i.onPageQueryResult(t)}}(i._ajaxFlag)})},doListQuery:function(){function n(e){t.onListQueryResult(e)}var e=this._setting.listUrl,t=this;e&&e.length>0&&$.ajax({url:e,dataType:"json",cache:!1,success:n})},onPageQueryResult:function(e){var t=this._map.getLayer(mapwork.MapPopLayer.ID);this._pageQueryResult=e;if(!e)return;var n=new mapwork.Bounds;if(!e.m_detail&&e.group)for(var r in e.group){var i=e.group[r],s=this.buildModuleItem(i,r);s.setMap(this._map),i._moduleItem=s;var o=s.getEarthPos();if(o){var u=o.convert2GlobalPos();u&&n.expandToIncludePoint(u.posX,u.posY)}var a=s.getMapIcon();t.addElement(a)}t.initLayer()},onListQueryResult:function(e){var t=this._map.getLayer("moduleListLayer");t?t.empty():(t=new mapwork.MapIconLayer("moduleListLayer"),this._map.addLayer(t)),this._listQueryResult=e;if(!e)return;if(!e.m_detail&&e.group)for(var n in e.group){var r=e.group[n],i=this.buildModuleItem(r);i.setMap(this._map),r._moduleItem=i,t.addElement(i.getMapIcon())}this._sideBar.onListQueryResult(e),t.initLayer()},getTestPageResult:function(){return null},getTestListResult:function(){return null}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(t,n){e&&e.apply(this,arguments)}mapwork.Search=t;var e=mapwork.ModuleItem;t.ID="Search",t.setting={ID:t.ID,pageUrl:null,listUrl:null,detailUrl:null,newModuleItem:function(e,n){return new t(e,n)}},t.prototype={},e&&mapwork.utils.inherits(t,e)}(),function(){function t(t){e&&e.apply(this,arguments),this._searchType="all",this._roles={},this._cards={},this._selectRole=null,this._$consoleWindow=$("#consoleWindow")}mapwork.SearchModule=t;var e=mapwork.Module;t.prototype={initRoles:function(){this.init();var e={group:{O_building1:{count:0,id:"O_building1",label:"Officer",locate:"building1",name:"Officer",pos:{lat:312727030,lon:1218229820},warn:!0},O_building2:{count:0,id:"O_building2",label:"Officer",locate:"building2",name:"Officer",pos:{lat:312727030,lon:1218285250},warn:!1},O_factory:{count:0,id:"O_factory",label:"Officer",locate:"factory",name:"Officer",pos:{lat:312697630,lon:1218285250},warn:!1},O_outside:{count:0,id:"O_outside",label:"Officer",locate:"outside",name:"Officer",pos:{lat:312683510,lon:1218318360},warn:!1},S_building1:{count:0,id:"S_building1",label:"Security",locate:"building1",name:"Security",pos:{lat:312727030,lon:1218241820},warn:!0},S_building2:{count:0,id:"S_building2",label:"Security",locate:"building2",name:"Security",pos:{lat:312727030,lon:1218297250},warn:!0},S_factory:{count:0,id:"S_factory",label:"Security",locate:"factory",name:"Security",pos:{lat:312697630,lon:1218297250},warn:!1},S_outside:{count:0,id:"S_outside",label:"Security",locate:"outside",name:"Security",pos:{lat:312683510,lon:1218330360},warn:!1},V_building1:{count:0,id:"V_building1",label:"VIP",locate:"building1",name:"VIP",pos:{lat:312727030,lon:1218253820},warn:!1},V_building2:{count:0,id:"V_building2",label:"VIP",locate:"building2",name:"VIP",pos:{lat:312727030,lon:1218309250},warn:!1},V_factory:{count:0,id:"V_factory",label:"VIP",locate:"factory",name:"VIP",pos:{lat:312697630,lon:1218309250},warn:!1},V_outside:{count:0,id:"V_outside",label:"VIP",locate:"outside",name:"VIP",pos:{lat:312683510,lon:1218342360},warn:!1},W_building1:{count:0,id:"W_building1",label:"Worker",locate:"building1",name:"Worker",pos:{lat:312727030,lon:1218217820},warn:!1},W_building2:{count:0,id:"W_building2",label:"Worker",locate:"building2",name:"Worker",pos:{lat:312727030,lon:1218273250},warn:!0},W_factory:{count:0,id:"W_factory",label:"Worker",locate:"factory",name:"Worker",pos:{lat:312697630,lon:1218273250},warn:!1},W_outside:{count:0,id:"W_outside",label:"Worker",locate:"outside",name:"Worker",pos:{lat:312683510,lon:1218306360},warn:!1}}},t=this._map.getLayer("moduleListLayer");t?t.empty():(t=new mapwork.MapIconLayer("moduleListLayer"),this._map.addLayer(t));if(e.group)for(var n in e.group){var r=e.group[n],i=this.buildRoleItem(r);i.setMap(this._map),t.addElement(i.getMapIcon())}t.initLayer(),this.doCardQuery()},buildRoleItem:function(e,t){var n=new mapwork.RoleItem(this,t);n.setJsonData(e),n.setSidebar(this._sideBar),n.setIcon("images/"+e.name+"1.png"),n._id=e.id,n._name=e.name,n.setZIndex(100-parseInt(t)),n.setOffsetPos([11,31]);if(e.pos){var r=new mapwork.EarthPos(e.pos.lat,e.pos.lon,!0);n.setEarthPos(r)}return n.setMap(this._map),this._roles[n._id]=n,n},setSearchType:function(e){this._searchType=e},setSearchCenterEPos:function(e){this._searchEPos=e},setSearchRadius:function(e){this._searchRadius=e},doCardQuery:function(){var e="work?action=initdatas&t="+(new Date).getTime(),t=this;mapwork.utils.loadJsonData(e,function(e){if(!e)return;e.today&&(mapwork.today=e.today),e.cards&&t.updateCardInfo(e.cards),e.register&&t.updateRegisterInfo(e.register)})},updateRegisterInfo:function(e){e&&(e.cardReg&&$("#cardReg").text(e.cardReg),e.cardUnreg&&$("#cardUnreg").text(e.cardUnreg),e.cardDeactive&&$("#cardDeactive").text(e.cardDeactive),e.deviceReg&&$("#deviceReg").text(e.deviceReg),e.deviceUnreg&&$("#deviceUnreg").text(e.deviceUnreg),e.deviceDeactive&&$("#deviceDeactive").text(e.deviceDeactive))},updateCardInfo:function(e){if(e)for(var t in e){var n=e[t],r=this.buildCardItem(n,t);if(r){this._cards[r._id]=r;var i=r._json.role;if(i){var s=i.substring(0,1)+"_"+r._json.lastLocate,o=this._roles[s];o&&r.setRole(o)}}}},findCards:function(e){this._selectRole&&(this._selectRole.clearFocus(),this._selectRole=null);var t,n,r=[];e=$.trim(e);if(e.length!==0)for(t in this._cards)n=this._cards[t],n.getId().indexOf(e)!==-1?r.push(n):n.getName().indexOf(e)!==-1&&r.push(n);return r},buildModuleItem:function(e,t){var n=e.type,r=this._map.getModule(n),i=r._setting.newModuleItem(r,t);i.setJsonData(e),i.setSidebar(this._sideBar),i._id=e.id,i._name=e.name,i.setDescribe(""),i.setZIndex(100-parseInt(t)),i.setOffsetPos([11,31]);if(e.pos){var s=new mapwork.EarthPos(e.pos.lat,e.pos.lon,!0);i.setEarthPos(s)}return i.setMap(this._map),i},clean:function(){this._sideBar.clean(),this.doRemoveIconList(),this.doHideTip();var e=this._map.getLayer("moduleListLayer");e&&e.empty(),this._searchHandler&&(this._searchHandler.doClose(),this._searchHandler.closePin())},setSearchHandler:function(e){this._searchHandler=e},updateDatas:function(e){if(e){e.register&&this.updateRegisterInfo(e.register);var t=e.cards;if(t)for(var n in t){var r=t[n],i=this._cards[r.id];i||(i=this.buildCardItem(r,n),this._cards[i._id]=i);if(i){var s=i._json.role;if(s){i.setLastEvent(r);var o=s.substring(0,1)+"_"+r.lastLocate,u=this._roles[o];u&&i.setRole(u)}}}var a=e.events;if(a){var f=this,l=$(".console-log");for(var c in a){var h=a[c],p=new Date(h.time),d="<li class='eventli'>"+h.seqId+"  "+mapwork.utils.formatDate(p,"day")+" "+mapwork.utils.formatDate(p,"time")+" "+h.cardId,i=this._cards[h.cardId];i&&(d+="["+i.getName()+"]"),d+="  "+h.deviceId+"["+h.deviceLocate+"]</li>";var v=$(d);v.get(0).currentEvent=h,v.click(function(e){f.selectLI(this)}),l.append(v)}var m=l.children(),g=50;if(m.length>g)for(var n=m.length-g-1;n>=0;n--)$(m.get(n)).remove();$(".console-wrapper").scrollTop($(".console-wrapper").height()+1e3)}}},selectLI:function(e){this._$selectLI&&this._$selectLI.removeClass("selectedLI"),this._$selectLI=$(e),this._$selectLI.addClass("selectedLI");if(e.currentEvent){var t=this._cards[e.currentEvent.cardId];if(t){var n=[];n.push(t),this._sideBar.onPageQueryResult(n,this)}}},buildCardItem:function(e,t){var n=null;if(e.actived){var n=new mapwork.CardItem(this,t,this._roles);n.setJsonData(e),n.setSidebar(this._sideBar),n._id=e.id,n._name=e.name,n.setIcon("images/"+e.role+"2.png"),n.setDescribe(""),n.setZIndex(100-parseInt(t)),n.setOffsetPos([11,31]),n.setMap(this._map)}return n}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(t,n){e&&e.apply(this,arguments),this._cards={},this._cardCount=0}mapwork.RoleItem=t;var e=mapwork.ModuleItem;t.ID="RoleItem",t.selectRoleItem=null,t.prototype={setJsonData:function(e){this._json=e,this.setZIndex(100-parseInt(this._index)),this.setIcon("images/"+this._json.name+"2.png"),this.setOffsetPos([11,31])},getTipTitle:function(){return this._json.name},getTipContent:function(){return"<p>"+this._json.name+"</p>"},isNeedItemQuery:function(){return!1},createMapIcon:function(){var e=this._id,t=this._icon,n=null,r=this._offsetPos;return this._moduleLabel||(this._moduleLabel=new mapwork.CommonItemLabel(e,t,n,r,this._zIndex,this),this._moduleLabel.setWarn(this._json.warn),this._moduleLabel.setLabel(this._json.label,this._json.count)),this._moduleLabel},addCard:function(e){this._cards[e._id]=e,this._cardCount++,this.updateCount()},removeCard:function(e){delete this._cards[e._id],this._cardCount--,this.updateCount()},getCardCount:function(){return this._cardCount},updateCount:function(){this._moduleLabel&&this._moduleLabel.setLabel(this._json.label,this._cardCount)},doFocus:function(){t.selectRoleItem&&t.selectRoleItem.clearFocus(),this._moduleLabel.doFocus(),this._sideBar.onPageQueryResult(this._cards),t.selectRoleItem=this,this._module._selectRole=this},clearFocus:function(){this._moduleLabel.clearFocus()}},e&&mapwork.utils.inherits(t,e)}(),function(){function n(n,r,i){e&&e.apply(this,arguments),this._roles=i,this._$SidebarContent=$(t)}mapwork.CardItem=n;var e=mapwork.ModuleItem;n.ID="CardItem";var t='<div  class="listing">  <div class="main viewed on"><div class="row"><div class="info span4"><div class="first_photo_imagebox thumbnail lazy"> <img id="cardImage"></img></div><div id="cardName" class="title ellipsis" style="Color:blue;"></div><div id="cardInfo" class="title ellipsis multiline"></div></div><ul class="meta-three-block"><li id="cardLocate" class="locate"></li><li id="cardTime"  class="time"></li></ul></div><div class="row list_footer"><div class="span list-footer-left"><span id="cardRole" class="follower-count"></span></div><div class="" style="right:0;position:absolute;"><div class="expand"><a  class="yuantie btn btn-link btn-success" href="#">查看详细记录</a></div></div></div> </div> <div class="popuplist-main hide"><div class="modal-header">      <div class="row">    <div  class="calendar">  <div  id="dp3" class="input-append date"> <input class="span2" size="10" type="text" readonly />     <span class="add-on"><i class="icon-th"></i></span>     </div> </div>        </div>                    </div>                           <div class="popuplist-main-body modal-body">           <div class="popuplist-descr">           <span style="margin-left:15px;">行踪详情</span><span id="detailRefresh" style="margin-left:30px;" class="btn btn-info btn-small"><i>刷新</i></span>            <div class="cardDetail row infobox descrbox chu_descr ellipsis multiline"></div>        </div></div></div> </div>';n.prototype={getType:function(){return this._json.role},getLocation:function(){return this._json.lastLocate},setJsonData:function(e){this._json=e,this.setZIndex(100-parseInt(this._index)),this.setOffsetPos([11,31])},getTipTitle:function(){return this._json.name},getTipContent:function(){return"<p>"+this._json.name+"</p>"},isNeedItemQuery:function(){return!1},createMapIcon:function(){var e=this._id,t=this._icon,n=null,r=this._offsetPos,i=new mapwork.CommonItemLabel(e,t,n,r,this._zIndex,this);return i.setLabel(this._json.label,this._json.count),i},setRole:function(e){this._role?this._role!==e&&(this._role.removeCard(this),this._role=e,this._role.addCard(this)):(this._role=e,this._role.addCard(this))},getRole:function(){return this._role},loadCardEvents:function(e){var t=this._$Content.find(".cardDetail");t.empty();var n="work?action=loadevents&cardid="+this._id+"&date="+e+"&t="+(new Date).getTime();e&&(n+="&date="+e);var r=this;mapwork.utils.loadJsonData(n,function(e){if(!e)return;var n='<table class="table"><tbody><tr><th>Index</th><th>日期</th><th>时间</th><th>方位</th>';for(var r=e.length-1;r>=0;r--)n=n+"<tr><td>"+(r+1)+"</td>"+"<td>"+mapwork.utils.formatDate(new Date(e[r].time),"day")+"</td>"+"<td>"+mapwork.utils.formatDate(new Date(e[r].time),"time")+"</td>"+"<td>"+'<span class="metadata"'+' title="'+e[r].deviceId+'">'+e[r].deviceLocate+"</span></td></tr>";n+="</tbody></table>",t.html(n)})},afterExpandDetail:function(){this.loadCardEvents(mapwork.today)},getName:function(){return this._json.name},getId:function(){return this._json.id},getInfo:function(){return this._json.info?this._json.info:""},setLastEvent:function(e){e.lastLocate!==this._json.lastLocate&&this._$SidebarContent.find("#cardLocate").css("background","blue"),this._$SidebarContent.find("#cardTime").css("background","blue"),this._json.lastLocate=e.lastLocate,this._json.lastTime=e.lastTime,this._json.lastDeviceId=e.lastDeviceId,this._$SidebarContent.find("#cardLocate").html(this._json.lastLocate),this._$SidebarContent.find("#cardTime").html(mapwork.utils.formatDate(new Date(this._json.lastTime),"time"));var t=this;setTimeout(function(){t._$SidebarContent.find("#cardLocate").css("background","#efefef"),t._$SidebarContent.find("#cardTime").css("background","#efefef")},1500)},reset:function(){this._$detailPage.hide()},getSidebarContent:function(){this._$detailPage=this._$SidebarContent.find(".popuplist-main"),this._$SidebarContent.find("#cardImage").attr("src",this.getIcon()).attr("title","ID:"+this._json.id),this._$SidebarContent.find("#cardName").html(this._json.name).attr("title","ID:"+this._json.id),this._json.info&&this._$SidebarContent.find("#cardInfo").html(this._json.info).attr("title",this._json.info),this._$SidebarContent.find("#cardLocate").html(this._json.lastLocate).attr("title",this._json.lastDeviceId),this._$SidebarContent.find("#cardTime").html(mapwork.utils.formatDate(new Date(this._json.lastTime),"time")).attr("title",mapwork.utils.formatDate(new Date(this._json.lastTime),"day")),this._$SidebarContent.find("#cardRole").html(this._json.role);var e=this,t=mapwork.utils.formatDate(new Date,"day");this._refreshButton=this._$SidebarContent.find("#detailRefresh"),this._refreshButton.click(function(){var n=mapwork.utils.date10ToDate8(t);e.loadCardEvents(n)});var n=this._$SidebarContent.find("#dp3");return n.datepicker({format:"yyyy-mm-dd",autoclose:!0,todayBtn:"linked",todayHighlight:!0,language:"zh-CN"}),n.datepicker("update",t),n.on("changeDate",function(t){e.changeDate(t.date)}),this._$SidebarContent},changeDate:function(e){if(e){var t=1900+e.getYear();e.getMonth()<10&&(t+="0"),t+=e.getMonth()+1,e.getDate()<10&&(t+="0"),t+=e.getDate(),t===mapwork.today?this._refreshButton.show():this._refreshButton.hide(),this.loadCardEvents(t)}}},e&&mapwork.utils.inherits(n,e)}(),function(){function n(t,n,r,i,s,o){e&&e.apply(this,arguments),this._moduleItem=o,this.init()}mapwork.CommonItemLabel=n;var e=mapwork.MapIcon,t='<div style="text-align: center;width:80px;height:30px;"><div style="width:80px;height:30px;"><img class="cautionImg" style="display:none;" title="Caution,restricted location!"></div><div class="roleCount" style="color:#000;font-size:11px;font-weight:bold;">0</div><img class="roleImg"><div class="iconLabel" style="font-size:14px;color:#000;"></div></div>';n.prototype={init:function(){this._htmlObj=document.createElement("div"),this._htmlObj.style.position="absolute",this._$Element=$(this._htmlObj),this._$Element.append(t),this._$IconNameDiv=this._$Element.find(".iconLabel"),this._$RoleCountDiv=this._$Element.find(".roleCount"),this._$CautionImage=this._$Element.find(".cautionImg"),this._$Image=this._$Element.find(".roleImg"),this._image=this._$Image.get(0),this.setIcon(this._defaultIcon),this._zIndex&&(this._htmlObj.style["z-index"]=this._zIndex)},setIcon:function(e){typeof e=="string"?this._image.src=e:e instanceof mapwork.SpriteImage&&e.wrapImage(this._image)},setWarn:function(e){this.warn=e,e&&(this._$RoleCountDiv.css("color","red"),this._$CautionImage.get(0).src="images/caution.gif")},setLabel:function(e,t){this._$IconNameDiv.html(e),this._$RoleCountDiv.html(t),this.warn&&t>0?this._$CautionImage.show():this._$CautionImage.hide()},setHoverImage:function(){this._zIndex!==undefined&&(this._htmlObj.style["z-index"]=101),this._$IconNameDiv.css("fontWeight","bold")},setDefaultImage:function(){this._zIndex!==undefined&&(this._htmlObj.style["z-index"]=this._zIndex),this._$IconNameDiv.css("fontWeight","normal")},updateMapZoom:function(e){},doFocus:function(){this._$Image.addClass("imageSelect")},clearFocus:function(){this._$Image.removeClass("imageSelect")}},e&&mapwork.utils.inherits(n,e)}(),function(){function t(t){e&&e.apply(this,arguments),this._mapWrapDiv=t,this.initFrame(),this.buildFrame(),this.onPageLoad()}mapwork.VisitorPage=t;var e=mapwork.WebFrame;t.prototype={createMap:function(){this._map=new mapwork.Map(this._mapWrapDiv,{}),this._searchModule=new mapwork.SearchModule(mapwork.Search.setting),this._map.addModule(this._searchModule),this._msg=new mapwork.WSMessage(this),this._msg.initialize()},buildFrame:function(){this.createMap()},onWindowResize:function(){var e=document.getElementById("n").clientHeight,t=document.getElementById("cn").clientHeight,n=document.getElementById("cs").clientHeight,r=document.getElementById("cc"),i=mapwork.utils.getClientSize().height-e-t-n;r.style.height=i+"px",this._map.resetSize(),mapwork.resizeListener&&mapwork.resizeListener(),this.sideBarResize()},sideBarResize:function(){var e=this._searchModule._sideBar;e.resize()},doMeasure:function(){var e=this._map.getHandler(mapwork.MeasureHandler.ID);e&&e.beginMeasure()},doVectorTest:function(){var e=this._map.getLayer(mapwork.MapVectorLayer.ID);e&&e.doTest()},moveToDefaultPos:function(){var e=mapwork.configs.defaultLat,t=mapwork.configs.defaultLon,n=new mapwork.EarthPos(e,t);this._map.movedToMapCenter(n)},changeMapStyle:function(){mapwork.mapStyle===mapwork.mapStyle1?mapwork.mapStyle=mapwork.mapStyle2:mapwork.mapStyle=mapwork.mapStyle1,setCookie("mapStyle",mapwork.mapStyle,999999);var e=this._map.getLayer(mapwork.TileLayer.ID);e&&e.changeUrl()},toggleMapTraffic:function(){var e=this._map.getControl(mapwork.TrafficControl.ID);return e?e.toggleTraffic():!1},onPageLoad:function(){this._searchModule.initRoles()}},e&&mapwork.utils.inherits(t,e)}(),function(){function t(e){this.socket=null,this.module=null,this.visitorPage=e}mapwork.WSMessage=t;var e=null;t.prototype={initialize:function(){window.location.protocol=="http:"?this.connect("ws://"+window.location.host+"/ws"):this.connect("wss://"+window.location.host+"/ws")},connect:function(e){var t=this;if("WebSocket"in window)this.socket=new WebSocket(e);else{if(!("MozWebSocket"in window))return;this.socket=new MozWebSocket(e)}this.socket.onopen=function(){t.module=t.visitorPage._map.getModule(mapwork.Search.ID)},this.socket.onclose=function(){},this.socket.onmessage=function(e){var n=JSON.parse(e.data);t.module.updateDatas(n)}}}}();